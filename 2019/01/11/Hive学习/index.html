<!DOCTYPE html>
<html lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no">
<meta name="author" content="Sukie">



<meta name="description" content="用于数据分析、统计的数据仓库">
<meta name="keywords" content="Hive">
<meta property="og:type" content="article">
<meta property="og:title" content="Hive学习">
<meta property="og:url" content="http://sungithup.github.io/2019/01/11/Hive学习/index.html">
<meta property="og:site_name" content="Sukie山脉">
<meta property="og:description" content="用于数据分析、统计的数据仓库">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/005zftzDgy1fz2wawi0ujj30h106c0tg.jpg">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20181113225516701.?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3d3d3p5ZGNvbQ==,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/005zftzDgy1fz53mse6n1j30fe0c3jxm.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/005zftzDgy1fz53p74gyrj30fe07sab1.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/005zftzDgy1fz5b7di85fj30rn0eodhm.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/005zftzDgy1fz5bus4ks8j30kb08o3zp.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/005zftzDgy1fz5c0cf550j30k406tjtk.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/005zftzDgy1fz5c6wynhnj30hs07kgmv.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/005zftzDgy1fz5c8bvsjkj30im077wft.jpg">
<meta property="og:updated_time" content="2019-03-27T15:10:27.014Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hive学习">
<meta name="twitter:description" content="用于数据分析、统计的数据仓库">
<meta name="twitter:image" content="https://ws1.sinaimg.cn/large/005zftzDgy1fz2wawi0ujj30h106c0tg.jpg">

<link rel="apple-touch-icon" href="/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="Sukie山脉" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>Hive学习 | Sukie山脉</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: true
    }
</script>


    <script>
        yiliaConfig.jquery_ui = [true, "//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js", "//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css"];
    </script>



    <script> yiliaConfig.rootUrl = "\/";</script>





    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?bc39ced90d9f89c71fda7b7d4ca8b638";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
        })();
    </script>


</head></html>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Sukie</a></h1>
        </hgroup>

        
        <p class="header-subtitle">肆意玩耍，肆意高歌</p>
        

        
            <form id="search-form">
            <input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="false">
            <i class="fa fa-times" onclick="resetSearch()"></i>
            </form>
            <div id="local-search-result"></div>
            <p class="no-result">No results found <i class="fa fa-spinner fa-pulse"></i></p>
        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/essays/">推荐</a></li>
                        
                            <li><a href="/books/">书籍</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:sunyaru216@163.com" title="Email"></a>
                            
                                <a class="fa 新浪微博" href="http://weibo.com/sunrise200 " title="新浪微博"></a>
                            
                                <a class="fa GitHub" href="https://github.com/sungithup" title="GitHub"></a>
                            
                                <a class="fa RSS" href="/atom.xml" title="RSS"></a>
                            
                                <a class="fa 博客园" href="/cnblogs" title="博客园"></a>
                            
                                <a class="fa CSDN" href="/" title="CSDN"></a>
                            
                                <a class="fa 网易云音乐" href="https://music.163.com/#/song?id=18949687" title="网易云音乐"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Array/">Array</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CentOS-6/">CentOS 6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HBase/">HBase</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HDFS/">HDFS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hive/">Hive</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/">JVM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux命令/">Linux命令</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux系统环境/">Linux系统环境</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/List/">List</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Map/">Map</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MapReduce/">MapReduce</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/">Nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Set/">Set</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spark-shell/">Spark shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SparkStreaming/">SparkStreaming</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spark框架/">Spark框架</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spark框架-SparkSql-SQL语句/">Spark框架 - SparkSql - SQL语句</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sqoop/">Sqoop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Storm，流式处理框架/">Storm，流式处理框架</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/String/">String</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Zookeeper/">Zookeeper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flume/">flume</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/">github</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hadoop/">hadoop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maven/">maven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/yarn/">yarn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分布式搜索和分析引擎/">分布式搜索和分析引擎</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分布式离线计算框架/">分布式离线计算框架</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分而治之/">分而治之</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/参数解释/">参数解释</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/广播/">广播</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/流式处理框架/">流式处理框架</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/源码分析/">源码分析</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/累加器/">累加器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/编程语言/">编程语言</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/计算引擎/">计算引擎</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/计算框架/">计算框架</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/静态/">静态</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">正宗小白</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Sukie</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Sukie</a></h1>
            </hgroup>
            
            <p class="header-subtitle">肆意玩耍，肆意高歌</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/essays/">推荐</a></li>
                
                    <li><a href="/books/">书籍</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:sunyaru216@163.com" title="Email"></a>
                            
                                <a class="fa 新浪微博" target="_blank" href="http://weibo.com/sunrise200 " title="新浪微博"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/sungithup" title="GitHub"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                                <a class="fa 博客园" target="_blank" href="/cnblogs" title="博客园"></a>
                            
                                <a class="fa CSDN" target="_blank" href="/" title="CSDN"></a>
                            
                                <a class="fa 网易云音乐" target="_blank" href="https://music.163.com/#/song?id=18949687" title="网易云音乐"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我">
</nav>
      <div class="body-wrap"><article id="post-Hive学习" class="article article-type-post" itemscope="" itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/01/11/Hive学习/" class="article-date">
      <time datetime="2019-01-10T16:00:00.000Z" itemprop="datePublished">2019-01-11</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Hive学习
    </h1>
  

        
           <div style="margin-top:10px;"> 
     <span class="post-time"> 
           <span class="post-meta-item-icon"> 
                 <i class="fa fa-keyboard-o"></i> 
                 <span class="post-meta-item-text"> 字数统计: </span> 
                 <span class="post-count">10.7k字</span> 
           </span>
     </span> 

     <span class="post-time">
           |   
           <span class="post-meta-item-icon"> 
                 <i class="fa fa-hourglass-half"></i> 
                 <span class="post-meta-item-text"> 阅读时长: </span> 
                 <span class="post-count">49分</span> 
           </span> 
     </span> 
</div>

           
      </header>     
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/HDFS/">HDFS</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hive/">Hive</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="一、Hive是什么？"><a href="#一、Hive是什么？" class="headerlink" title="一、Hive是什么？"></a>一、Hive是什么？</h2><h3 id="1、基于-Hadoop-的一个数据仓库工具"><a href="#1、基于-Hadoop-的一个数据仓库工具" class="headerlink" title="1、基于 Hadoop 的一个数据仓库工具"></a>1、基于 Hadoop 的一个<code>数据仓库工具</code></h3><ul>
<li>可以将<code>结构化</code>的数据文件映射为一张<code>hive数据库表</code>；</li>
<li>这张Hive数据库表保存不了metadata元数据信息，而是将metadata存储在本地磁盘上的MySQL（关系型数据库）中</li>
<li>并提供简单的 sql 查询功能；</li>
<li>可以将 sql 语句转换为 MapReduce 任务进行运行。</li>
</ul>
<h3 id="2、快速实现简单的MapReduce-统计的工具"><a href="#2、快速实现简单的MapReduce-统计的工具" class="headerlink" title="2、快速实现简单的MapReduce 统计的工具"></a>2、快速实现简单的MapReduce 统计的工具</h3><ul>
<li>方便非Java编程者对HDFS的数据做mapreduce操作；</li>
<li>学习成本低，十分适合数据仓库的统计分析。</li>
</ul>
<h3 id="3、什么是数据仓库？"><a href="#3、什么是数据仓库？" class="headerlink" title="3、什么是数据仓库？"></a>3、什么是数据仓库？</h3><ul>
<li>Data Warehouse(DW 或DWH）是为企业所有级别的决策制定过程，提供所有类型数据支持的战略集合。</li>
<li>单个数据存储，出于分析性报告和决策支持目的而创建。</li>
<li>为需要业务智能的企业，提供指导业务流程改进、监视时间、成本、质量以及控制.</li>
<li><strong>数据仓库</strong>是用来做<strong>查询分析的数据库</strong>，<strong>基本不用来做插入，修改，删除操作</strong>。</li>
</ul>
<h3 id="4、数据处理的两大分类"><a href="#4、数据处理的两大分类" class="headerlink" title="4、数据处理的两大分类"></a>4、数据处理的两大分类</h3><p><img src="https://ws1.sinaimg.cn/large/005zftzDgy1fz2wawi0ujj30h106c0tg.jpg" alt="oltp+olap"><span class="img-alt">oltp+olap</span></p>
<ul>
<li><h4 id="联机事务处理OLTP（on-line-transaction-processing）"><a href="#联机事务处理OLTP（on-line-transaction-processing）" class="headerlink" title="联机事务处理OLTP（on-line transaction processing）"></a>联机事务处理OLTP（on-line transaction processing）</h4></li>
</ul>
<blockquote>
<p>OLTP是传统的关系型<a href="http://lib.csdn.net/base/mysql" target="_blank" rel="noopener">数据库</a>的主要应用，主要是基本的、日常的事务处理，例如银行交易。</p>
<p>OLTP系统强调数据库内存效率，强调内存各种指标的命令率，强调绑定变量，强调并发操作；</p>
</blockquote>
<ul>
<li><h4 id="联机分析处理OLAP（On-Line-Analytical-Processing）"><a href="#联机分析处理OLAP（On-Line-Analytical-Processing）" class="headerlink" title="联机分析处理OLAP（On-Line Analytical Processing）"></a>联机分析处理OLAP（On-Line Analytical Processing）</h4></li>
</ul>
<blockquote>
<p>OLAP是数据仓库系统的主要应用，支持复杂的分析操作，侧重决策支持，并且提供直观易懂的查询结果。</p>
<p>OLAP系统则强调数据分析，强调SQL执行市场，强调磁盘I/O，强调分区等。</p>
</blockquote>
<ul>
<li>数据文件按结构的分类</li>
</ul>
<blockquote>
<p>结构化数据：关系型</p>
<p>半结构化数据：K-V</p>
<p>松散型：</p>
</blockquote>
<p>原理：</p>
<p>Hive包括：解释器、编译器、优化器</p>
<p>其中，编译器将一个HiveSQL 转换为操作符，操作符是Hive的最小的处理单位，每一个操作符代表HDFS的一个操作或一个MapReduce作业。</p>
<h2 id="二、Hive架构原理"><a href="#二、Hive架构原理" class="headerlink" title="二、Hive架构原理"></a>二、Hive架构原理</h2><p><img src="https://img-blog.csdnimg.cn/20181113225516701.?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3d3d3p5ZGNvbQ==,size_16,color_FFFFFF,t_70" alt="Hive架构图"><span class="img-alt">Hive架构图</span></p>
<p>1、架构图解释：</p>
<blockquote>
<p>Hive通过用户提供的一系列交互接口，接收到用户的指令(SQL)，使用自己的Driver，结合元数据(MetaStore)，将这些指令翻译成MapReduce，提交到Hadoop中执行，最后，将执行返回的结果输出到用户交互接口</p>
</blockquote>
<p>2、用户接口</p>
<blockquote>
<p> 主要有三个：Client CLI(hive shell 命令行)，JDBC/ODBC(java访问hive)，WEBUI(浏览器访问hive)</p>
<p>​         其中最常用的是<strong>CLI命令行</strong>，Cli启动的时候，会同时启动一个Hive副本；<strong>Client</strong>是Hive的客户端，用户连接至Hive Server。在启动 Client模式的时候，需要指出Hive Server所在节点，并且在该节点启动Hive Server。</p>
</blockquote>
<p>3、元数据:Metastore </p>
<blockquote>
<p>元数据包括:</p>
<p>表名,表所属数据库(默认是default) ,表的拥有者,列/分区字段,表的类型(是否是外部表),表的数据所在目录等；</p>
<p>默认存储在自带的derby数据库中,推荐使用MySQL存储Metastore</p>
</blockquote>
<p>4、任务运行</p>
<blockquote>
<p>Hive 使用HDFS进行存储,使用MapReduce进行计算</p>
<p>(0)驱动器:Driver</p>
<p>(1)解析器(SQL Parser):将SQL字符转换成抽象语法树AST,这一步一般使用都是第三方工具库完成,比如antlr,对AST进行语法分析,比如表是否存在,字段是否存在,SQL语句是否有误</p>
<p>(2)编译器(Physical Plan):将AST编译生成逻辑执行计划 </p>
<p>(3)优化器(Query Optimizer):对逻辑执行计划进行优化</p>
<p>(4)执行器(Execution):把逻辑执行计划转换成可以运行的物理计划,对于Hive来说,就是MR/Spark</p>
<p>  其中(select *  不会产生MR任务)</p>
</blockquote>
<h2 id="三、Hive搭建及三种模式"><a href="#三、Hive搭建及三种模式" class="headerlink" title="三、Hive搭建及三种模式"></a>三、Hive搭建及三种模式</h2><h3 id="1、Hive的安装配置："><a href="#1、Hive的安装配置：" class="headerlink" title="1、Hive的安装配置："></a>1、Hive的安装配置：</h3><h4 id="（1）基本环境：Hadoop集群环境（至少3个节点）"><a href="#（1）基本环境：Hadoop集群环境（至少3个节点）" class="headerlink" title="（1）基本环境：Hadoop集群环境（至少3个节点）"></a>（1）基本环境：Hadoop集群环境（至少3个节点）</h4><blockquote>
<p><strong>Hive</strong>是依赖于hadoop系统的，因此在运行Hive之前需要保证已经搭建好hadoop集群环境。</p>
</blockquote>
<h4 id="（2）安装一个关系型数据mysql"><a href="#（2）安装一个关系型数据mysql" class="headerlink" title="（2）安装一个关系型数据mysql"></a>（2）安装一个关系型数据mysql</h4><blockquote>
<p>因为Hive数据仓库的元数据信息是存放在本地磁盘的关系数据库上的</p>
</blockquote>
<p><code>安装步骤</code>：详见  “Linux系统数据库MySQL安装.md”</p>
<h4 id="（3）解压安装（按需在指定节点上）"><a href="#（3）解压安装（按需在指定节点上）" class="headerlink" title="（3）解压安装（按需在指定节点上）"></a>（3）解压安装（按需在指定节点上）</h4><blockquote>
<p>解压apache-hive-1.2.1-bin.tar.gz</p>
</blockquote>
<h4 id="（4）追加配置环境变量"><a href="#（4）追加配置环境变量" class="headerlink" title="（4）追加配置环境变量"></a>（4）追加配置环境变量</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bash_profile</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HIVE_HOME=Hive的解压路径</span><br><span class="line"></span><br><span class="line">HIVE_HOME=/usr/soft/apache-hive-1.2.1-bin</span><br><span class="line">export PATH=$PATH:$HIVE_HOME/bin</span><br></pre></td></tr></table></figure>
<h4 id="（5）替换和添加相关jar包"><a href="#（5）替换和添加相关jar包" class="headerlink" title="（5）替换和添加相关jar包"></a>（5）替换和添加相关jar包</h4><blockquote>
<ul>
<li><p>修改HADOOP_HOME/share/hadoop/yarn/lib目录下的jline-*.jar </p>
<p>将其替换成HIVE_HOME/lib下的<code>jline-2.12.jar</code>。 </p>
</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li><p>–将如下(<code>hive连接mysql)</code>的jar包拷贝到hive解压目录的lib目录下</p>
<p><code>mysql-connector-java-5.1.32-bin.jar</code></p>
</li>
</ul>
</blockquote>
<h4 id="（6）修改配置文件（选择3种模式里哪一种）"><a href="#（6）修改配置文件（选择3种模式里哪一种）" class="headerlink" title="（6）修改配置文件（选择3种模式里哪一种）"></a>（6）修改配置文件（选择3种模式里哪一种）</h4><p><code>见三种安装模式</code></p>
<h4 id="（7）启动"><a href="#（7）启动" class="headerlink" title="（7）启动"></a>（7）启动</h4><blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> hive </span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>启动hive交互式界面</p>
</blockquote>
<h3 id="2、三种模式"><a href="#2、三种模式" class="headerlink" title="2、三种模式"></a>2、三种模式</h3><table>
<thead>
<tr>
<th>三种模式</th>
</tr>
</thead>
<tbody>
<tr>
<td>A、内嵌模式（元数据保存在内嵌的derby中，允许一个会话链接，尝试多个会话链接时会报错）【了解】                                                                                                        B、本地模式（本地安装mysql 替代derby存储元数据）【重要】                                                                                  C、远程模式（远程安装mysql 替代derby存储元数据）【重要】</td>
</tr>
</tbody>
</table>
<h4 id="（1）内嵌Derby单用户模式（了解）"><a href="#（1）内嵌Derby单用户模式（了解）" class="headerlink" title="（1）内嵌Derby单用户模式（了解）"></a>（1）内嵌Derby单用户模式（了解）</h4><ul>
<li>元数据是内嵌在Derby数据库中的，只能允许一个会话连接，数据会存放到HDFS上。</li>
<li>存储方式简单，只需要hive-site.xml </li>
<li>注：使用 derby<br>存储方式时，运行 hive 会在当前目录生成一个 derby 文件和一个metastore_db</li>
</ul>
<p>hive-site.xml ：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionURL<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>jdbc:derby:;databaseName=metastore_db;create=true<span class="tag">&lt;/<span class="name">value</span>&gt;</span> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionDriverName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.derby.jdbc.EmbeddedDriver<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.local<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.warehouse.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>/user/hive/warehouse<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="（2）本地用户模式（重要，多用于本地开发测试）"><a href="#（2）本地用户模式（重要，多用于本地开发测试）" class="headerlink" title="（2）本地用户模式（重要，多用于本地开发测试）"></a>（2）本地用户模式（<code>重要</code>，多用于本地开发测试）</h4><table>
<thead>
<tr>
<th>与嵌入式的区别</th>
</tr>
</thead>
<tbody>
<tr>
<td><em> 不再使用内嵌的Derby作为元数据的存储介质，而是使用其他数据库比如MySQL来存储元数据且是一个多用户的模式，运行多个用户client连接到一个数据库中。这种方式一般作为公司内部同时使用Hive。                                                                                                                                                                               </em> 这里有一个前提，每一个用户必须要有对MySQL的访问权利，即每一个客户端使用者需要知道MySQL的用户名和密码才行。</td>
</tr>
</tbody>
</table>
<ul>
<li>需要在本地运行一个 mysql 服务器</li>
<li>在node00上（与MySQL在同一个节点上）解压安装Hive</li>
</ul>
<blockquote>
<p>MySQL， Hive      :  node00</p>
</blockquote>
<ul>
<li>需要将 连接mysql 的 jar 包（mysql-connector-java-5.1.32-bin.jar）拷贝到$HIVE_HOME/lib 目录下</li>
</ul>
<p>hive-site.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.warehouse.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>/user/hive_local/warehouse<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.local<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionURL<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>jdbc:mysql://node00:3306/hive_local?createDatabaseIfNotExist=true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionDriverName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionUserName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>root<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionPassword<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>注意</code>：需要实现在mysql中创建数据库：hive_local</p>
<h4 id="（3）远程模式（重要）"><a href="#（3）远程模式（重要）" class="headerlink" title="（3）远程模式（重要）"></a>（3）远程模式（重要）</h4><ul>
<li><h5 id="remote-一体"><a href="#remote-一体" class="headerlink" title="remote 一体"></a>remote 一体</h5></li>
</ul>
<blockquote>
<p>将Hive解压安装与MySQL不同的节点上</p>
<p>MySQL  ：node00</p>
<p>Hive  ： node02</p>
<p>需要在 Hive服务器启动 meta服务</p>
<p>Hive的服务端和客户端在同一台节点</p>
</blockquote>
<p>配置hive-site.xml（在 node02节点上）</p>
<p>(hadoop 2.6.5)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.warehouse.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>/user/hive_remote/warehouse<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionURL<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>jdbc:mysql://node02:3306/hive_remote?createDatabaseIfNotExist=true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionDriverName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionUserName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>root<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionPassword<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.local<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果在hadoop2.5.X环境下还需要添加</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.uris<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>thrift://node02:9083<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>注</code><strong>：</strong>这里把hive的服务端和客户端都放在同一台服务器上了。服务端和客户端可以拆开</p>
<ul>
<li><h5 id="Remote-分开-公司企业经常用"><a href="#Remote-分开-公司企业经常用" class="headerlink" title="Remote 分开(公司企业经常用)"></a>Remote 分开(公司企业经常用)</h5></li>
</ul>
<p>将 hive-site.xml 配置文件拆为如下两部分（此时不与MySQL在同一台节点上）</p>
<blockquote>
<p>MySql  ：   node00</p>
<p>服务端 ：   node02</p>
<p>客户端 ：   node01</p>
</blockquote>
<p><strong>1</strong>）、服务端配置文件（node02）</p>
<p>配置hive-site.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.warehouse.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>/user/hive2/warehouse<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionURL<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>jdbc:mysql://node00:3306/hive2?createDatabaseIfNotExist=true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionDriverName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionUserName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>root<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionPassword<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>2</strong>）、客户端配置文件（node01）</p>
<p> 配置hive-site.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.warehouse.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/user/hive2/warehouse<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--注意这里的路径要和服务端一致---&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.local<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.uris<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>thrift://node02:9083<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>启动 hive 服务端程序</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive --service metastore &amp;</span><br></pre></td></tr></table></figure>
<p><strong>客户端启动</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive</span><br></pre></td></tr></table></figure>
<p>Hive常见问题总汇：</p>
<p><a href="http://blog.csdn.net/freedomboy319/article/details/44828337" target="_blank" rel="noopener">http://blog.csdn.net/freedomboy319/article/details/44828337</a></p>
<p><a href="https://gengqi88.iteye.com/blog/1983492" target="_blank" rel="noopener">https://gengqi88.iteye.com/blog/1983492</a></p>
<blockquote>
<p>如果报错：</p>
<p>org.apache.thrift.transport.TTransportException: Could not create ServerSocket on address 0.0.0.0/0.0.0.0:9083.</p>
</blockquote>
<p>查看进程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jps</span><br></pre></td></tr></table></figure>
<p>将启动命令的节点上所以Runjar  进程执行如下kill 命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -9 pid</span><br></pre></td></tr></table></figure>
<h2 id="四、HQL详解"><a href="#四、HQL详解" class="headerlink" title="四、HQL详解"></a>四、HQL详解</h2><p><code>Hql 就是HiveSQl语句</code></p>
<h3 id="1、DDL语句（数据库定义语言）"><a href="#1、DDL语句（数据库定义语言）" class="headerlink" title="1、DDL语句（数据库定义语言）"></a>1、DDL语句（数据库定义语言）</h3><h4 id="（1）具体参见：https-cwiki-apache-org-confluence-display-Hive-LanguageManual-DDL"><a href="#（1）具体参见：https-cwiki-apache-org-confluence-display-Hive-LanguageManual-DDL" class="headerlink" title="（1）具体参见：https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL"></a>（1）具体参见：<a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL" target="_blank" rel="noopener">https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL</a></h4><p><code>Hive的数据定义语言</code> （<a href="javascript:changelink(&#39;https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL&#39;,&#39;EN2ZH_CN&#39;" target="_blank" rel="noopener">LanguageManual DDL</a>;)）</p>
<p><strong><code>重点</code> hive 的建表语句和分区。</strong></p>
<h4 id="（2）创建-删除-修改-使用数据库"><a href="#（2）创建-删除-修改-使用数据库" class="headerlink" title="（2）创建/删除/修改/使用数据库"></a>（2）创建/删除/修改/使用数据库</h4><ul>
<li><h5 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h5></li>
</ul>
<p>（Hive搭建完毕后，会创建一个默认的数据库）</p>
<blockquote>
<p>查看    show databases；</p>
</blockquote>
<blockquote>
<p>创建    </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> CREATE (DATABASE|SCHEMA) [IF NOT EXISTS] database_name [COMMENT database_comment];</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>举例：</p>
<p>create database attribute;</p>
<p>create database attr;</p>
</blockquote>
<p><code>注意：</code>创建数据时，数据库名不要和系统关键字冲突，否则会报错；</p>
<p>如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">命令：</span><br><span class="line">hive&gt; create database out;</span><br><span class="line"></span><br><span class="line">报错：</span><br><span class="line">FAILED: ParseException line 1:16 Failed to recognize predicate 'out'. Failed rule: 'identifier' in create database statement</span><br><span class="line"></span><br><span class="line">原因：</span><br><span class="line">在Hive1.2.0版本开始增加了如下配置选项，默认值为true：</span><br><span class="line"></span><br><span class="line">hive.support.sql11.reserved.keywords</span><br><span class="line"></span><br><span class="line">该选项的目的是：是否启用对SQL2011保留关键字的支持。 启用后，将支持部分SQL2011保留关键字。</span><br><span class="line"></span><br><span class="line">解决：</span><br><span class="line">法一：弃用这个关键字，换个名字</span><br><span class="line">法二：弃用对保留关键字的支持</span><br><span class="line">在conf下的hive-site.xml配置文件中修改配置选项：</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.support.sql11.reserved.keywords<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><h5 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h5><blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> DROP (DATABASE|SCHEMA) [IF EXISTS] database_name;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>举例：</p>
<p>drop database attribute;</p>
</blockquote>
</li>
</ul>
<ul>
<li>修改数据库(了解)</li>
</ul>
<blockquote>
<p>ALTER (DATABASE|SCHEMA) database_name SET DBPROPERTIES (property_name=property_value, …);</p>
<p>ALTER (DATABASE|SCHEMA) database_name SET OWNER [USER|ROLE] user_or_role; </p>
</blockquote>
<ul>
<li><h5 id="使用数据库-（进入某一数据库。如果没有这步操作，会进入默认default数据库）"><a href="#使用数据库-（进入某一数据库。如果没有这步操作，会进入默认default数据库）" class="headerlink" title="使用数据库 （进入某一数据库。如果没有这步操作，会进入默认default数据库）"></a>使用数据库 （进入某一数据库。如果没有这步操作，会进入默认default数据库）</h5></li>
</ul>
<blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> USE database_name;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>举例：</p>
<p>use attr；</p>
</blockquote>
<h4 id="（3）创建-删除-表（重点）"><a href="#（3）创建-删除-表（重点）" class="headerlink" title="（3）创建/删除/表（重点）"></a>（3）创建/删除/表（重点）</h4><ul>
<li><h5 id="创建表（重要！）"><a href="#创建表（重要！）" class="headerlink" title="==创建表（重要！）=="></a>==创建表（重要！）==</h5></li>
</ul>
<p>数据类型：</p>
<blockquote>
<p>data_type<br>  : <code>primitive_type  原始数据类型</code><br>  | <code>array_type        数组</code><br>  | <code>map_type        map</code><br>  | struct_type<br>  | union_type  – (Note: Available in Hive 0.7.0 and later)</p>
<p><em>primitive_type</em><br>  : TINYINT<br>  | SMALLINT<br>  | <code>INT</code><br>  | <code>BIGINT</code><br>  | BOOLEAN<br>  | FLOAT<br>  | <code>DOUBLE</code><br>  | DOUBLE PRECISION<br>  | <strong>STRING  基本可以搞定一切</strong><br>  | BINARY<br>  | TIMESTAMP<br>  | DECIMAL<br>  | DECIMAL(precision, scale)<br>  | <code>DATE</code><br>  | VARCHAR<br>  | CHAR  </p>
<p><em>array_type</em><br>  : <code>ARRAY &lt; data_type &gt;</code></p>
<p><em>map_type</em><br>  : <code>MAP &lt; primitive_type, data_type &gt;</code></p>
<p><em>struct_type</em><br>  : STRUCT &lt; col_name : data_type [COMMENT col_comment], …&gt;</p>
<p><em>union_type</em><br>  : UNIONTYPE &lt; data_type, data_type, … &gt;  </p>
</blockquote>
<ul>
<li><h5 id="1、准备数据"><a href="#1、准备数据" class="headerlink" title="1、准备数据"></a>1、准备数据</h5></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1,zshang,18,game-girl-book,stu_addr:beijing-work_addr:shanghai</span><br><span class="line">2,lishi,16,shop-boy-book,stu_addr:hunan-work_addr:shanghai</span><br><span class="line">3,wang2mazi,20,fangniu-eat,stu_addr:shanghai-work_addr:tianjing</span><br></pre></td></tr></table></figure>
<ul>
<li><h5 id="2、创建表"><a href="#2、创建表" class="headerlink" title="2、创建表"></a>2、创建表</h5></li>
</ul>
<p>(如果没有指定进入某一数据库，就会在默认数据库中创建)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">log</span>(</span><br><span class="line"> <span class="keyword">id</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="keyword">name</span> <span class="keyword">string</span>,</span><br><span class="line"> age <span class="built_in">int</span>,</span><br><span class="line"> likes <span class="built_in">array</span>&lt;<span class="keyword">string</span>&gt;,</span><br><span class="line"> address <span class="keyword">map</span>&lt;<span class="keyword">string</span>,<span class="keyword">string</span>&gt;</span><br><span class="line"> )</span><br><span class="line"> <span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span></span><br><span class="line"> COLLECTION ITEMS <span class="keyword">TERMINATED</span> <span class="keyword">by</span> <span class="string">'-'</span></span><br><span class="line"> <span class="keyword">map</span> <span class="keyword">keys</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">':'</span></span><br><span class="line"> <span class="keyword">lines</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">'\n'</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>导入数据</strong>（属于DML但是为了演示需要在此应用）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">LOAD DATA [LOCAL] INPATH &apos;filepath&apos; [OVERWRITE] INTO TABLE tablename [PARTITION (partcol1=val1, partcol2=val2 ...)]</span><br><span class="line"></span><br><span class="line"> [LOCAL]:从本地  |  若无，则为从HDFS</span><br><span class="line"> [OVERWRITE]  ： 会覆盖Hive表中的数据   | 若无则会追加</span><br><span class="line"> </span><br><span class="line"> [PARTITION....] ： 创建分区</span><br></pre></td></tr></table></figure>
<blockquote>
<p>将log1文件中的数据加载到log表中</p>
<p>（log1中数据的格式要和log表格式保持一致，否则会乱；若文件已存在，则会自动重命名）</p>
<ul>
<li>本地加载（相当于复制）数据到Hive的制定表中</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> LOAD DATA LOCAL INPATH <span class="string">'/root/su/log1'</span> INTO TABLE <span class="built_in">log</span>;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<ul>
<li>HDFS加载（相当于剪切）数据到Hive的制定表中</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> LOAD DATA INPATH <span class="string">'/root/su/log1'</span> INTO TABLE <span class="built_in">log</span> ;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
</blockquote>
<ul>
<li>查看表中数据</li>
</ul>
<blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> 对本表查询不会产生MapReduce任务</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> hive&gt; select * from <span class="built_in">log</span>;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> 使用函数查询会产生MapReduce任务</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> hive&gt; select count(*) from <span class="built_in">log</span>;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> 查询表的字段信息：描述字段类型</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> hive&gt; desc <span class="built_in">log</span>;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>第一个查询结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1	zshang	18	[&quot;game&quot;,&quot;girl&quot;,&quot;book&quot;]	&#123;&quot;stu_addr&quot;:&quot;beijing&quot;,&quot;work_addr&quot;:&quot;shanghai&quot;&#125;</span><br><span class="line">1	zhaoliu	18	[&quot;game&quot;,&quot;girl&quot;,&quot;book&quot;]	&#123;&quot;stu_addr&quot;:&quot;beijing&quot;,&quot;work_addr&quot;:&quot;shanghai&quot;&#125;</span><br><span class="line">2	lishi	16	[&quot;shop&quot;,&quot;boy&quot;,&quot;book&quot;]	&#123;&quot;stu_addr&quot;:&quot;hunan&quot;,&quot;work_addr&quot;:&quot;shanghai&quot;&#125;</span><br><span class="line">3	wang2mazi	20	[&quot;fangniu&quot;,&quot;eat&quot;]	&#123;&quot;stu_addr&quot;:&quot;shanghai&quot;,&quot;work_addr&quot;:&quot;tianjing&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>第二个查询结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4</span><br></pre></td></tr></table></figure>
<p><code>附加题</code></p>
<blockquote>
<p>查询表中likes字段中有girl的人</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive&gt; select name from log2 where likes[1]=&quot;girl&quot;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>查询表中address字段有stu_addr为beijing的人</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive&gt;  select name from log2 where address[&quot;stu_addr&quot;]=&quot;beijing&quot;;</span><br></pre></td></tr></table></figure>
<ul>
<li><h5 id="3、删除表"><a href="#3、删除表" class="headerlink" title="3、删除表"></a>3、删除表</h5></li>
</ul>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; DROP TABLE [IF EXISTS] table_name [PURGE];</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>举例：</p>
<p>（用drop命令删除表，会将表中数据一并删除，其对应在MySQl中的表的元数据信息也会随之删除；</p>
<p>​    用hdfs命令删除表对应的文件目录，表中数据也一并删除，但其元数据信息依然保存在My  SQL上，</p>
<p>​     再load数据，可恢复该表）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </p>
</blockquote>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; drop table log1；</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; hdfs dfs -rmr /user/hive_local/warehouse/attr.db/log1</span><br><span class="line">&gt; </span><br><span class="line">&gt; hive&gt; use attr;</span><br><span class="line">&gt; hive&gt; LOAD DATA LOCAL INPATH &apos;/root/su/log1&apos; INTO TABLE log1;</span><br><span class="line">&gt; </span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
</blockquote>
<ul>
<li><h5 id="创建外部表（重要）"><a href="#创建外部表（重要）" class="headerlink" title="创建外部表（重要）"></a>创建外部表（重要）</h5></li>
</ul>
<blockquote>
<p>外部关键字EXTERNAL允许您创建一个表,并提供一个位置,以便hive不使用这个表的默认位置。<strong>这方便如果你已经生成了数据，当删除一个外部表</strong>,<strong>表中的数据不会从文件系统中删除</strong>。外部表指向任何HDFS的存储位置,而不是存储在配置属性指定的文件夹<a href="javascript:changelink(&#39;https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-hive.metastore.warehouse.dir&#39;,&#39;EN2ZH_CN&#39;" target="_blank" rel="noopener"> hive.metastore.warehouse.dir</a>;)中</p>
</blockquote>
<p>创建表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">create EXTERNAL table log1(</span><br><span class="line"> id int,</span><br><span class="line"> name string,</span><br><span class="line"> age int,</span><br><span class="line"> likes array&lt;string&gt;,</span><br><span class="line"> address map&lt;string,string&gt;</span><br><span class="line"> )</span><br><span class="line"> row format delimited fields terminated by &apos;,&apos;</span><br><span class="line"> COLLECTION ITEMS TERMINATED by &apos;-&apos;</span><br><span class="line"> map keys terminated by &apos;:&apos;</span><br><span class="line"> lines terminated by &apos;\n&apos;;</span><br></pre></td></tr></table></figure>
<p>加载数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LOAD DATA LOCAL INPATH &apos;/root/su/log1&apos; INTO TABLE log1;</span><br></pre></td></tr></table></figure>
<p>删除外部表（<code>相当于删除的是表的元数据信息，而表中的数据还保存</code>）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop table log1；</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<blockquote>
<p>hive&gt; show tables;</p>
<p>无log1</p>
<p>MySQl中也无此表元数据信息</p>
<p>但是，</p>
<p>在HDFS文件系统中，此表数据依然存在</p>
<p>也就是说，此表还可以恢复</p>
</blockquote>
<p>恢复表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">重新创建log1表，该表即可恢复</span><br></pre></td></tr></table></figure>
<h4 id="（4）修改表-更新，删除数据-这些很少用"><a href="#（4）修改表-更新，删除数据-这些很少用" class="headerlink" title="（4）修改表,更新，删除数据(这些很少用)"></a>（4）修改表,更新，删除数据(这些很少用)</h4><p>重命名表</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; ALTER TABLE table_name RENAME TO new_table_name;</span><br><span class="line">&gt; </span><br><span class="line">&gt; Eg: alter table meninem rename to jacke;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
</blockquote>
<p>更新数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE tablename SET column = value [, column = value ...][WHERE expression]</span><br></pre></td></tr></table></figure>
<p>删除数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM tablename [WHERE expression]</span><br></pre></td></tr></table></figure>
<h3 id="2、DML语句（数据库管理语言）"><a href="#2、DML语句（数据库管理语言）" class="headerlink" title="2、DML语句（数据库管理语言）"></a>2、DML语句（数据库管理语言）</h3><h4 id="（1）具体参见："><a href="#（1）具体参见：" class="headerlink" title="（1）具体参见："></a>（1）具体参见：</h4><p><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DML" target="_blank" rel="noopener">https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DML</a></p>
<p>   <strong>重点是数据加载和查询插入语法</strong></p>
<p>Hive数据操作语言（<a href="javascript:changelink(&#39;https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DML&#39;,&#39;EN2ZH_CN&#39;" target="_blank" rel="noopener">LanguageManual DML</a>;)）</p>
<h4 id="（2）四种插入-导入数据-重要"><a href="#（2）四种插入-导入数据-重要" class="headerlink" title="（2）四种插入/导入数据(重要)"></a>（2）四种插入/导入数据(重要)</h4><blockquote>
<p>Hive不能很好的支持用<code>insert</code>语句一条一条的进行插入操作，不支持<code>update</code>操作。数据是以<code>load</code>的方式加载到建立好的表中。数据一旦导入就不可以修改。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create table log3(</span><br><span class="line"> id int,</span><br><span class="line"> name string,</span><br><span class="line"> age int</span><br><span class="line"> )</span><br><span class="line"> row format delimited fields terminated by &apos;,&apos;</span><br><span class="line"> lines terminated by &apos;\n&apos;;</span><br></pre></td></tr></table></figure>
<h5 id="1-直接加载数据"><a href="#1-直接加载数据" class="headerlink" title="1.直接加载数据"></a>1.直接加载数据</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LOAD DATA [LOCAL] INPATH 'filepath' [OVERWRITE] INTO TABLE tablename [PARTITION (partcol1=val1, partcol2=val2 ...)]</span><br><span class="line">load data local inpath '/root/su/log1' into table log1;</span><br></pre></td></tr></table></figure>
<h5 id="2-将表1查询结果插入表2"><a href="#2-将表1查询结果插入表2" class="headerlink" title="2.将表1查询结果插入表2"></a>2.将表1查询结果插入表2</h5><p><code>注意：查询结果的字段个数、类型 要与插入的表的字段一 一匹配对应</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">创建person2表，然后从表person1查询数据导入：</span><br><span class="line">覆盖：</span><br><span class="line">INSERT OVERWRITE TABLE person2 [PARTITION(dt=&apos;2008-06-08&apos;, country)]</span><br><span class="line">       SELECT id,name, age From ppt;</span><br><span class="line">追加：</span><br><span class="line">INSERT INTO TABLE log3 </span><br><span class="line">       SELECT id,name, age From log;</span><br></pre></td></tr></table></figure>
<h5 id="3-将表1、表2查询结果插入表3、表4"><a href="#3-将表1、表2查询结果插入表3、表4" class="headerlink" title="3.将表1、表2查询结果插入表3、表4"></a>3.将表1、表2查询结果插入表3、表4</h5><p><code>注意：查询结果的字段个数、类型 要与插入的表的字段一 一匹配对应</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">FROM person t1</span><br><span class="line">INSERT OVERWRITE | INTO TABLE person1 [PARTITION(dt=&apos;2008-06-08&apos;, country)]</span><br><span class="line">       SELECT t1.id, t1.name, t1.age ;</span><br><span class="line">       </span><br><span class="line">FROM log t1,log1 t2 </span><br><span class="line">INSERT OVERWRITE TABLE log4  </span><br><span class="line"> SELECT t1.id,t1.name,t2.age ;</span><br><span class="line"> </span><br><span class="line"> 是否存在笛卡尔积：？？？？存在。</span><br><span class="line"> </span><br><span class="line"> 为了防止笛卡尔积：</span><br><span class="line"> FROM log t1,log1 t2 </span><br><span class="line">INSERT OVERWRITE TABLE log4  </span><br><span class="line"> SELECT t1.id,t1.name,t2.age where t1.id =t2.id;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">【from放前面好处就是后面可以插入多条语句 】</span><br><span class="line">FROM abc t1,sun t2 </span><br><span class="line">INSERT OVERWRITE TABLE qiniu  </span><br><span class="line"> SELECT t1.id,t1.name,t1.age,t2.likes,t2.address ;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FROM abc t1,sun t2 </span><br><span class="line">INSERT OVERWRITE TABLE qiniu  </span><br><span class="line"> SELECT t1.id,t1.name,t1.age,t1.likes,t1.address where…</span><br><span class="line">INSERT OVERWRITE TABLE wbb</span><br><span class="line"> SELECT t2.id,t2.name,t2.age,t2.likes,t2.address where…;</span><br></pre></td></tr></table></figure>
<h5 id="4-直接列出数据插入表中（大量数据时不推荐）"><a href="#4-直接列出数据插入表中（大量数据时不推荐）" class="headerlink" title="4.直接列出数据插入表中（大量数据时不推荐）"></a>4.直接列出数据插入表中（大量数据时不推荐）</h5><p><code>注意：查询结果的字段个数、类型 要与插入的表的字段一 一匹配对应</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO TABLE students</span><br><span class="line">   VALUES (1,&apos;zs&apos;,18,&apos;boy&apos;,&apos;beijng&apos;),(2,&apos;wh&apos;,&apos;girl&apos;,&apos;stu_addr&apos;:shanghai&apos;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>本地load数据和从HDFS上load加载数据的过程有什么<code>区别</code>？</p>
<ul>
<li><p>本地： local 会自动复制到HDFS上的hive的**目录下</p>
</li>
<li><p>Hdfs导入 后移动到hive的**目录下</p>
</li>
</ul>
</blockquote>
<h4 id="（3）查询数据并保存"><a href="#（3）查询数据并保存" class="headerlink" title="（3）查询数据并保存"></a>（3）查询数据并保存</h4><ol>
<li><ul>
<li><h5 id="保存数据到本地："><a href="#保存数据到本地：" class="headerlink" title="保存数据到本地："></a>保存数据到本地：</h5></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">insert overwrite local directory '/opt/datas/hive_exp_emp2'</span><br><span class="line">     ROW FORMAT DELIMITED FIELDS TERMINATED BY ','</span><br><span class="line">         select * from db_1128.emp ;</span><br><span class="line">留意两种的区别：保存的数据格式</span><br><span class="line"></span><br><span class="line">insert overwrite local directory '/sun/temp/hive_save1'</span><br><span class="line">     row format delimited fields terminated by ','</span><br><span class="line">      COLLECTION ITEMS TERMINATED by '-'</span><br><span class="line">      map keys terminated by ':'      </span><br><span class="line">          select * from log2 ;</span><br><span class="line">          </span><br><span class="line">这里如果将 overwrite  改为into 会报错。</span><br></pre></td></tr></table></figure>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//查看数据</span><br><span class="line">!cat /sun/temp/hive_save1/000000_0;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><ul>
<li><h5 id="保存数据到HDFS上："><a href="#保存数据到HDFS上：" class="headerlink" title="保存数据到HDFS上："></a>保存数据到HDFS上：</h5></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">insert overwrite directory &apos;/user/beifeng/hive/hive_exp_emp&apos;</span><br><span class="line">     select * from db_1128.emp ;</span><br><span class="line"></span><br><span class="line">insert overwrite directory &apos;/sun/hive/temp/hive_save1&apos;</span><br><span class="line">      row format delimited fields terminated by &apos;,&apos;</span><br><span class="line">      COLLECTION ITEMS TERMINATED by &apos;-&apos;</span><br><span class="line">      map keys terminated by &apos;:&apos;</span><br><span class="line">      select * from log2 ;</span><br><span class="line">     </span><br><span class="line">这里如果将 overwrite  改为into 会报错。</span><br></pre></td></tr></table></figure>
</li>
<li><ul>
<li><h5 id="在外部shell中将数据重定向到文件中："><a href="#在外部shell中将数据重定向到文件中：" class="headerlink" title="在外部shell中将数据重定向到文件中："></a>在外部shell中将数据重定向到文件中：</h5></li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(注意：需要指明是哪个数据库的表)</span><br><span class="line"># hive -e &quot;select * from attr.log;&quot; &gt; /sun/hive/temp/hive_save2</span><br><span class="line"># cat /sun/hive/temp/hive_save2</span><br></pre></td></tr></table></figure>
<h4 id="（4）备份数据或还原数据（在HDFS上）"><a href="#（4）备份数据或还原数据（在HDFS上）" class="headerlink" title="（4）备份数据或还原数据（在HDFS上）"></a>（4）备份数据或还原数据（在HDFS上）</h4><ol>
<li><ul>
<li>备份数据（包括表的元数据和表中的数据）：</li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPORT TABLE log to &apos;/sun/hive/datas/export/cp1&apos;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><ul>
<li>删除再还原数据：</li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">先删除表。</span><br><span class="line">drop table log;</span><br><span class="line">show tables ;</span><br><span class="line">再还原数据：</span><br><span class="line">IMPORT FROM &apos;/sun/hive/datas/export/cp1&apos; ;</span><br></pre></td></tr></table></figure>
<h4 id="（5）其他Hql操作"><a href="#（5）其他Hql操作" class="headerlink" title="（5）其他Hql操作"></a>（5）其他Hql操作</h4><h5 id="Hive的group-by-join-left-join-right-join等-having-sort-by-order-by等操作和MySQL没有什么大的区别："><a href="#Hive的group-by-join-left-join-right-join等-having-sort-by-order-by等操作和MySQL没有什么大的区别：" class="headerlink" title="Hive的group by\join(left join right join等)\having\sort by \order by等操作和MySQL没有什么大的区别："></a>Hive的group by\join(left join right join等)\having\sort by \order by等操作和MySQL没有什么大的区别：</h5><p><a href="http://www.2cto.com/kf/201609/545560.html" target="_blank" rel="noopener">http://www.2cto.com/kf/201609/545560.html</a></p>
<h3 id="3、Hive-SerDe（序列化、反序列化）"><a href="#3、Hive-SerDe（序列化、反序列化）" class="headerlink" title="3、Hive SerDe（序列化、反序列化）"></a>3、Hive SerDe（序列化、反序列化）</h3><h4 id="1-定义"><a href="#1-定义" class="headerlink" title="(1)定义"></a>(1)定义</h4><p><strong><code>Hive SerDe</code></strong> - Serializer and Deserializer  SerDe 用于做序列化和反序列化。</p>
<p>构建在数据存储和执行引擎之间，对两者实现解耦。</p>
<p>对数据实现序列化，清洗数据，使之成为有效数据并加载。</p>
<p>Hive通过ROW FORMAT DELIMITED以及SERDE进行内容的读写。</p>
<h4 id="（2）实现"><a href="#（2）实现" class="headerlink" title="（2）实现"></a>（2）实现</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">row_format</span><br><span class="line">: DELIMITED </span><br><span class="line">          [FIELDS TERMINATED BY char [ESCAPED BY char]] </span><br><span class="line">          [COLLECTION ITEMS TERMINATED BY char] </span><br><span class="line">          [MAP KEYS TERMINATED BY char] </span><br><span class="line">          [LINES TERMINATED BY char] </span><br><span class="line">: SERDE serde_name [WITH SERDEPROPERTIES (property_name=property_value, property_name=property_value, ...)]</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Hive正则匹配（实现数据清洗）</span><br><span class="line">创建表 logtbl：</span><br><span class="line"></span><br><span class="line"> CREATE TABLE logtbl (</span><br><span class="line">    host STRING,</span><br><span class="line">    identity STRING,</span><br><span class="line">    t_user STRING,</span><br><span class="line">    time STRING,</span><br><span class="line">    request STRING,</span><br><span class="line">    referer STRING,</span><br><span class="line">    agent STRING)</span><br><span class="line">  ROW FORMAT SERDE &apos;org.apache.hadoop.hive.serde2.RegexSerDe&apos;</span><br><span class="line">  WITH SERDEPROPERTIES (</span><br><span class="line"> &quot;input.regex&quot;=&quot;([^ ]*) ([^ ]*) ([^ ]*) \\[(.*)\\] \&quot;(.*)\&quot; (-|[0-9]*) (-|[0-9]*)&quot;) </span><br><span class="line">  STORED AS TEXTFILE;</span><br><span class="line">  </span><br><span class="line">加载数据:</span><br><span class="line"></span><br><span class="line">load data local inpath &apos;/root/su/localhost_access_log.2016-02-29&apos; into table logtbl;</span><br><span class="line"></span><br><span class="line">查看数据：</span><br><span class="line"></span><br><span class="line">select * from logtbl;</span><br><span class="line"></span><br><span class="line">显示：</span><br><span class="line">//192.168.57.4 - - [29/Feb/2016:18:14:35 +0800] &quot;GET /bg-upper.png HTTP/1.1&quot; 304 -</span><br><span class="line"></span><br><span class="line">192.168.57.4	-	-	29/Feb/2016:18:14:35 +0800	GET /bg-upper.png HTTP/1.1	304    -</span><br><span class="line">192.168.57.4	-	-	29/Feb/2016:18:14:35 +0800	GET /bg-nav.png HTTP/1.1	304    -</span><br><span class="line">192.168.57.4	-	-	29/Feb/2016:18:14:35 +0800	GET /asf-logo.png HTTP/1.1	304    -</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">(省略。。。)</span><br></pre></td></tr></table></figure>
<p><code>表数据--见数据文件：localhost_access_log.2016-02-29.txt</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">192.168.57.4 - - [29/Feb/2016:18:14:35 +0800] &quot;GET /bg-upper.png HTTP/1.1&quot; 304 -</span><br><span class="line">192.168.57.4 - - [29/Feb/2016:18:14:35 +0800] &quot;GET /bg-nav.png HTTP/1.1&quot; 304 -</span><br><span class="line">192.168.57.4 - - [29/Feb/2016:18:14:35 +0800] &quot;GET /asf-logo.png HTTP/1.1&quot; 304 -</span><br><span class="line">192.168.57.4 - - [29/Feb/2016:18:14:35 +0800] &quot;GET /bg-button.png HTTP/1.1&quot; 304 -</span><br><span class="line">192.168.57.4 - - [29/Feb/2016:18:14:35 +0800] &quot;GET /bg-middle.png HTTP/1.1&quot; 304 -</span><br><span class="line">192.168.57.4 - - [29/Feb/2016:18:14:36 +0800] &quot;GET / HTTP/1.1&quot; 200 11217</span><br><span class="line">192.168.57.4 - - [29/Feb/2016:18:14:36 +0800] &quot;GET / HTTP/1.1&quot; 200 11217</span><br><span class="line">192.168.57.4 - - [29/Feb/2016:18:14:36 +0800] &quot;GET /tomcat.css HTTP/1.1&quot; 304 -</span><br><span class="line">192.168.57.4 - - [29/Feb/2016:18:14:36 +0800] &quot;GET /tomcat.png HTTP/1.1&quot; 304 -</span><br><span class="line">192.168.57.4 - - [29/Feb/2016:18:14:36 +0800] &quot;GET /asf-logo.png HTTP/1.1&quot; 304 -</span><br><span class="line">192.168.57.4 - - [29/Feb/2016:18:14:36 +0800] &quot;GET /bg-middle.png HTTP/1.1&quot; 304 -</span><br><span class="line">192.168.57.4 - - [29/Feb/2016:18:14:36 +0800] &quot;GET /bg-button.png HTTP/1.1&quot; 304 -</span><br><span class="line">192.168.57.4 - - [29/Feb/2016:18:14:36 +0800] &quot;GET /bg-nav.png HTTP/1.1&quot; 304 -</span><br><span class="line">192.168.57.4 - - [29/Feb/2016:18:14:36 +0800] &quot;GET /bg-upper.png HTTP/1.1&quot; 304 -</span><br><span class="line">192.168.57.4 - - [29/Feb/2016:18:14:36 +0800] &quot;GET / HTTP/1.1&quot; 200 11217</span><br><span class="line">192.168.57.4 - - [29/Feb/2016:18:14:36 +0800] &quot;GET /tomcat.css HTTP/1.1&quot; 304 -</span><br><span class="line">192.168.57.4 - - [29/Feb/2016:18:14:36 +0800] &quot;GET /tomcat.png HTTP/1.1&quot; 304 -</span><br><span class="line">192.168.57.4 - - [29/Feb/2016:18:14:36 +0800] &quot;GET / HTTP/1.1&quot; 200 11217</span><br><span class="line">192.168.57.4 - - [29/Feb/2016:18:14:36 +0800] &quot;GET /tomcat.css HTTP/1.1&quot; 304 -</span><br><span class="line">192.168.57.4 - - [29/Feb/2016:18:14:36 +0800] &quot;GET /tomcat.png HTTP/1.1&quot; 304 -</span><br><span class="line">192.168.57.4 - - [29/Feb/2016:18:14:36 +0800] &quot;GET /bg-button.png HTTP/1.1&quot; 304 -</span><br><span class="line">192.168.57.4 - - [29/Feb/2016:18:14:36 +0800] &quot;GET /bg-upper.png HTTP/1.1&quot; 304 -</span><br></pre></td></tr></table></figure>
<h2 id="五、Beeline和Hiveserver2（Hive的升级）"><a href="#五、Beeline和Hiveserver2（Hive的升级）" class="headerlink" title="五、Beeline和Hiveserver2（Hive的升级）"></a>五、Beeline和Hiveserver2（Hive的升级）</h2><h4 id="1、Hiveserver2直接启动（只能在服务端启动，相当于服务端）"><a href="#1、Hiveserver2直接启动（只能在服务端启动，相当于服务端）" class="headerlink" title="1、Hiveserver2直接启动（只能在服务端启动，相当于服务端）"></a>1、Hiveserver2直接启动（只能在服务端启动，相当于服务端）</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># ./hiveserver2</span><br></pre></td></tr></table></figure>
<p>若已经配置环境变量则启动方式为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># hivesever2</span><br></pre></td></tr></table></figure>
<h4 id="2、启动-beeline（可在服务端-客户端启动，相当于客户端）"><a href="#2、启动-beeline（可在服务端-客户端启动，相当于客户端）" class="headerlink" title="2、启动 beeline（可在服务端|客户端启动，相当于客户端）"></a>2、启动 beeline（可在服务端|客户端启动，相当于客户端）</h4><blockquote>
<p>因为beeline是在Hive安装目录的/bin下，所以只要有hive包都可以启动</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"># ./beeline</span><br><span class="line">beeline&gt; !connect jdbc:hive2://node00:10000 root 123456</span><br><span class="line">显示：</span><br><span class="line">Connecting to jdbc:hive2://node00:10000</span><br><span class="line">Connected to: Apache Hive (version 1.2.1)</span><br><span class="line">Driver: Hive JDBC (version 1.2.1)</span><br><span class="line">Transaction isolation: TRANSACTION_REPEATABLE_READ</span><br><span class="line">0: jdbc:hive2://node00:10000&gt;</span><br><span class="line">使用：列出数据库</span><br><span class="line">0: jdbc:hive2://node00:10000&gt; show databases;</span><br><span class="line">+----------------+--+</span><br><span class="line">| database_name  |</span><br><span class="line">+----------------+--+</span><br><span class="line">| attr           |</span><br><span class="line">| attribute      |</span><br><span class="line">| default        |</span><br><span class="line">+----------------+--+</span><br><span class="line">3 rows selected (7.493 seconds)</span><br><span class="line">0: jdbc:hive2://node00:10000&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">而在服务端：</span><br><span class="line">显示：</span><br><span class="line"></span><br><span class="line">[root@node00 ~]# hiveserver2</span><br><span class="line">19/01/07 08:52:09 WARN conf.HiveConf: HiveConf of name hive.metastore.local does not exist</span><br><span class="line">OK</span><br><span class="line">OK</span><br><span class="line">OK</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">退出：</span><br><span class="line">服务端：ctrl + c</span><br><span class="line">客户端：！quit；  或 ctrl + c</span><br><span class="line"></span><br><span class="line">作用：</span><br><span class="line">对操作结果添加了美化。不过不太常用，耗内存，数据大的时候，还影响页面。</span><br></pre></td></tr></table></figure>
<h2 id="六、Hive的JDBC"><a href="#六、Hive的JDBC" class="headerlink" title="六、Hive的JDBC"></a>六、Hive的JDBC</h2><blockquote>
<p>一般是平台使用展示或接口，服务端启动hiveserver2后，在java代码中通过调用hive的jdbc访问默认端口10000进行连接、访问</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HivejdbcClient</span> </span>&#123;    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String driverName = <span class="string">"org.apache.hive.jdbc.HiveDriver"</span>;   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;        </span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Class.forName(driverName);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (ClassNotFoundException)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.exit(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">// repalace "hive" here with the name of user the queries should run as</span></span><br><span class="line">        Connection con = DriverManager.getConnection(<span class="string">"jdbc:hive2://node00:10000/default"</span>,<span class="string">"root"</span>,<span class="string">"123456"</span>);</span><br><span class="line">        Statement stmt = con.createStatement();</span><br><span class="line">        String sql = <span class="string">"select * from log limit 0"</span>;</span><br><span class="line">        ResultSet rs = stmt.executeQuery(sql);</span><br><span class="line">        <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">            System.out.println(rs.getInt(<span class="number">1</span>)+<span class="string">"-"</span>+rs.getString(<span class="string">"name"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="七、-Hive分区与自定义函数UDF-UDAF-UDTF"><a href="#七、-Hive分区与自定义函数UDF-UDAF-UDTF" class="headerlink" title="七、==Hive分区与自定义函数UDF  UDAF UDTF=="></a>七、==Hive分区与自定义函数UDF  UDAF UDTF==</h2><h3 id="1、-Hive的分区partition（重要）"><a href="#1、-Hive的分区partition（重要）" class="headerlink" title="1、==Hive的分区partition（重要）=="></a>1、==Hive的分区partition（重要）==</h3><blockquote>
<p><code>功能：</code></p>
<p>为了方便海量数据的管理和查询，可以对数据建立分区（可按日期、部门、类型等具体业务）。进行分门别类的管理。</p>
</blockquote>
<blockquote>
<p><code>注意：</code></p>
<ul>
<li><p>必须在定义表的时候创建partition分区</p>
</li>
<li><p>存储数据时，添加分区字段的数据，直接将数据按分区进行存储。<br>   添加分区时：</p>
<p>   ​             时间的格式：/   ： 存储时会乱码，用   -  不会。<br>   ​             需要指定分区<br>   ​             多个分区时，存在父子目录关系，按顺序对应，对应父子<br>   ​             创建表时，已经指定分区个数，就只能填加指定个数的字段数据</p>
<pre><code>删除分区时：
</code></pre><p>   ​            若该分区是父分区的最后一个子区，则父分区也会被删除<br>   ​            若删除父分区，其所有子分区也都会被删除<br>   ​            若删除的分区，分别在多个不同父分区中存在，则都会被删除</p>
<pre><code>重命名分区时：
</code></pre><p>   ​            修改之后的名字不能是已经存在的</p>
</li>
<li><strong>注意：在创建 删除多分区等操作时一定要注意分区的先后顺序，他们是父子节点的关系。分区字段不要和表字段相同</strong></li>
</ul>
</blockquote>
<blockquote>
<p><code>类别：</code></p>
<ul>
<li>单分区和多分区</li>
<li>静态分区和动态分区</li>
</ul>
</blockquote>
<h4 id="（1）创建分区"><a href="#（1）创建分区" class="headerlink" title="（1）创建分区"></a>（1）创建分区</h4><ul>
<li><h5 id="单分区建表"><a href="#单分区建表" class="headerlink" title="单分区建表"></a>单分区建表</h5></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> day_table(</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">int</span>, </span><br><span class="line"><span class="keyword">content</span> <span class="keyword">string</span></span><br><span class="line">) </span><br><span class="line">partitioned <span class="keyword">by</span> (dt <span class="keyword">string</span>) </span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span>;</span><br></pre></td></tr></table></figure>
<p><code>注意：</code>【单分区表，按天分区，在表结构中存在id，content，dt三列；以dt为文件夹区分】</p>
<ul>
<li><h5 id="双分区建表"><a href="#双分区建表" class="headerlink" title="双分区建表"></a>双分区建表</h5></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> day_hour_table (</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">int</span>,</span><br><span class="line"><span class="keyword">content</span> <span class="keyword">string</span></span><br><span class="line">) </span><br><span class="line">partitioned <span class="keyword">by</span> (dt <span class="keyword">string</span>, <span class="keyword">hour</span> <span class="keyword">string</span>) </span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span>;</span><br></pre></td></tr></table></figure>
<p><code>注意：</code></p>
<p>【双分区表，按天和小时分区，在表结构中新增加了dt和hour两列；先以dt为文件夹，再以hour子文件夹区分】</p>
<h4 id="（2）添加分区表的分区"><a href="#（2）添加分区表的分区" class="headerlink" title="（2）添加分区表的分区"></a>（2）添加分区表的分区</h4><p>（表已创建，在此基础上添加分区：按什么分区）：</p>
<p><code>注意：报错</code>：此时添加，要注意分区的个数相对应，否则会报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FAILED: ValidationFailureSemanticException Partition spec &#123;dt=2008-08-08, hour=08&#125; contains non-partition columns</span><br></pre></td></tr></table></figure>
<p><code>注意：报错</code>此时添加，要注意分区的字段名要对应添加，否则会报如下错误：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FAILED: ValidationFailureSemanticException Partition spec &#123;d=2008-08-08&#125; contains non-partition columns</span><br></pre></td></tr></table></figure>
<p><code>注意：</code>一定是存在分区，才可添加</p>
<p> 添加分区：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name</span><br><span class="line"><span class="keyword">ADD</span> partition_spec [ LOCATION <span class="string">'location1'</span> ] partition_spec [ LOCATION <span class="string">'location2'</span> ] ...</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">例： </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> day_table <span class="keyword">ADD</span> <span class="keyword">PARTITION</span> (dt=<span class="string">'2028-08-08'</span>, <span class="keyword">hour</span>=<span class="string">'08'</span>);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> day_table <span class="keyword">ADD</span> <span class="keyword">PARTITION</span> (dt=<span class="string">'2028-08-08'</span>);</span><br></pre></td></tr></table></figure>
<h4 id="（3）删除分区"><a href="#（3）删除分区" class="headerlink" title="（3）删除分区"></a>（3）删除分区</h4><p>语法：（– 用户可以用 ALTER TABLE DROP PARTITION 来删除分区。分区的元数据和数据将被一并删除。）</p>
<p>删除如双分区中的子级分区时，如果仅剩一个子分区，那么父级分区也会被删除。（连坐）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name DROP partition_spec, partition_spec,...</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">例：</span><br><span class="line">ALTER TABLE day_hour_table DROP PARTITION (dt=&apos;2008-08-08&apos;, hour=&apos;08&apos;);</span><br><span class="line"></span><br><span class="line">ALTER TABLE day_hour_table DROP PARTITION (dt=&apos;2008-08-08&apos;);</span><br></pre></td></tr></table></figure>
<h4 id="（4）数据加载进分区表中"><a href="#（4）数据加载进分区表中" class="headerlink" title="（4）数据加载进分区表中"></a>（4）数据加载进分区表中</h4><p>语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LOAD</span> <span class="keyword">DATA</span> [<span class="keyword">LOCAL</span>] INPATH <span class="string">'filepath'</span> [OVERWRITE] <span class="keyword">INTO</span> <span class="keyword">TABLE</span> tablename [<span class="keyword">PARTITION</span> (partcol1=val1,partcol2=val2 ...)]</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HDFS：</span><br><span class="line"><span class="keyword">LOAD</span> <span class="keyword">DATA</span> INPATH <span class="string">'/user/pv.txt'</span> <span class="keyword">INTO</span> <span class="keyword">TABLE</span> day_hour_table <span class="keyword">PARTITION</span>(dt=<span class="string">'2008-08-08'</span>, <span class="keyword">hour</span>=<span class="string">'08'</span>);</span><br><span class="line"></span><br><span class="line">本地：</span><br><span class="line"><span class="keyword">LOAD</span> <span class="keyword">DATA</span> <span class="keyword">local</span> INPATH <span class="string">'/user/hua/*'</span> <span class="keyword">INTO</span> <span class="keyword">TABLE</span> day_hour <span class="keyword">partition</span>(dt=<span class="string">'2010-07-07'</span>);</span><br></pre></td></tr></table></figure>
<h4 id="（5）查看表的所有分区"><a href="#（5）查看表的所有分区" class="headerlink" title="（5）查看表的所有分区"></a>（5）查看表的所有分区</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hive&gt; show partitions day_hour_table;</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">partitions</span> day_table;</span><br></pre></td></tr></table></figure>
<h4 id="（6）重命名分区"><a href="#（6）重命名分区" class="headerlink" title="（6）重命名分区"></a>（6）重命名分区</h4><p>语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">PARTITION</span> partition_spec <span class="keyword">RENAME</span> <span class="keyword">TO</span> <span class="keyword">PARTITION</span> partition_spec1;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">例：</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> day_table </span><br><span class="line">              <span class="keyword">PARTITION</span> (tian=<span class="string">'2018-05-01'</span>) <span class="keyword">RENAME</span> <span class="keyword">TO</span> <span class="keyword">PARTITION</span> (tain=<span class="string">'2018-06-01'</span>);</span><br></pre></td></tr></table></figure>
<h4 id="（7）-动态分区-重要-–注意外部表"><a href="#（7）-动态分区-重要-–注意外部表" class="headerlink" title="（7）==动态分区(重要)–注意外部表=="></a>（7）==动态分区(重要)–注意外部表==</h4><ol>
<li><p>在本地文件/home/grid/a  中写入以下4行数据</p>
<blockquote>
<p> aaa,US,CA<br> aaa,US,CB<br> bbb,CA,BB<br> bbb,CA,BC</p>
</blockquote>
</li>
<li><p>建立非分区表并加载数据 </p>
</li>
</ol>
<p><strong>创建表</strong>   info1</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span>  (</span><br><span class="line">      <span class="keyword">name</span> <span class="keyword">STRING</span>, </span><br><span class="line">      cty <span class="keyword">STRING</span>, </span><br><span class="line">      st <span class="keyword">STRING</span></span><br><span class="line">) </span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> <span class="keyword">DELIMITED</span> <span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">','</span>;</span><br></pre></td></tr></table></figure>
<p><strong>加载数据</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LOAD</span> <span class="keyword">DATA</span> <span class="keyword">LOCAL</span> INPATH <span class="string">'/root/su/a'</span> <span class="keyword">INTO</span> <span class="keyword">TABLE</span> info1;</span><br></pre></td></tr></table></figure>
<p><strong>查看</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> info1;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>建立外部分区表  info2   , 并动态加载数据  （注意删除外部表的相关事项）</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">EXTERNAL</span> <span class="keyword">TABLE</span> info2 (</span><br><span class="line"><span class="keyword">name</span> <span class="keyword">STRING</span></span><br><span class="line">) </span><br><span class="line">PARTITIONED <span class="keyword">BY</span> (country <span class="keyword">STRING</span>, state <span class="keyword">STRING</span>);</span><br></pre></td></tr></table></figure>
<p><strong>实现动态分区</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> hive.exec.dynamic.partition=<span class="literal">true</span>;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> hive.exec.dynamic.partition.mode=nonstrict;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> hive.exec.max.dynamic.partitions.pernode=<span class="number">1000</span>;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">TABLE</span> info2 <span class="keyword">PARTITION</span> (country, state) <span class="keyword">SELECT</span> <span class="keyword">name</span>, cty, st <span class="keyword">FROM</span> info1; </span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">TABLE</span> info2 <span class="keyword">PARTITION</span> (country, state) <span class="keyword">SELECT</span> <span class="keyword">name</span>, cty, st <span class="keyword">FROM</span> info1; </span><br><span class="line"><span class="comment">--两次插入数据，会有两份相同的数据</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> info2;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>使用动态分区需要注意设定以下参数：</li>
</ol>
<blockquote>
<p> <strong>hive.exec.dynamic.partition</strong></p>
<p>默认值：false</p>
<p>是否开启动态分区功能，默认false关闭。</p>
<p>使用动态分区时候，该参数必须设置成true;</p>
</blockquote>
<blockquote>
<p><strong>hive.exec.dynamic.partition.mode</strong></p>
<p>默认值：strict</p>
<p>动态分区的模式，默认strict，表示必须指定至少一个分区为静态分区，nonstrict模式表示允许所有的分区字段都可以使用动态分区。</p>
<p>一般需要设置为nonstrict</p>
</blockquote>
<blockquote>
<p> <strong>hive.exec.max.dynamic.partitions.pernode</strong></p>
<p>默认值：100</p>
<p>在每个执行MR的节点上，最大可以创建多少个动态分区。</p>
<p>该参数需要根据实际的数据来设定。</p>
<p>比如：源数据中包含了一年的数据，即day字段有365个值，那么该参数就需要设置成大于365，如果使用默认值100，则会报错。</p>
</blockquote>
<blockquote>
<p><strong>hive.exec.max.dynamic.partitions</strong></p>
<p>默认值：1000</p>
<p>在所有执行MR的节点上，最大一共可以创建多少个动态分区。</p>
<p>同上参数解释。</p>
</blockquote>
<blockquote>
<p> <strong>hive.exec.max.created.files</strong></p>
<p>默认值：100000</p>
<p>整个MR Job中，最大可以创建多少个HDFS文件。</p>
<p>一般默认值足够了，除非你的数据量非常大，需要创建的文件数大于100000，可根据实际情况加以调整。</p>
</blockquote>
<blockquote>
<p> <strong>hive.error.on.empty.partition</strong></p>
<p>默认值：false</p>
<p>当有空分区生成时，是否抛出异常。</p>
<p>一般不需要设置。</p>
</blockquote>
<h3 id="2、自定义函数UDF-UDAF-UDTF"><a href="#2、自定义函数UDF-UDAF-UDTF" class="headerlink" title="2、自定义函数UDF  UDAF UDTF"></a>2、自定义函数UDF  UDAF UDTF</h3><blockquote>
<p>自定义函数包括三种 UDF、UDAF、UDTF</p>
<p>UDF：一进一出</p>
<p>UDAF：聚集函数，多进一出。如：Count/max/min</p>
<p>UDTF：一进多出，如 lateralview  explore()，（类似于mysql中的视图）</p>
<p><strong>使用方式</strong> ：在HIVE会话中add自定义函数的jar 文件，然后创建 function 继而使用函数</p>
</blockquote>
<h4 id="（1）UDF-开发（用的多一点）"><a href="#（1）UDF-开发（用的多一点）" class="headerlink" title="（1）UDF 开发（用的多一点）"></a>（1）UDF 开发（用的多一点）</h4><p>Hive的函数课参考官网，用时查阅即可： <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF" target="_blank" rel="noopener">https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF</a></p>
<p><strong>1、</strong>UDF函数可以直接应用于 select 语句，对查询结构做格式化处理后，再输出内容。</p>
<p><strong>2、</strong>编写 UDF 函数的时候需要注意一下几点：</p>
<p>  a）自定义 UDF 需要<code>继承</code> org.apache.hadoop.hive.ql.<code>UDF</code>。</p>
<p>  b）需要<code>实现</code> <code>evaluate</code> 函数，evaluate 函数支持重载。</p>
<p><strong>3、</strong>步骤</p>
<p>  a）把程序打包放到目标机器上去；</p>
<p>（需要hive和hadoop，jdk 的相关jar包）</p>
<p>函数一：脱敏处理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bigdata.hive.udf;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hive.ql.exec.UDF;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TuoMing</span> <span class="keyword">extends</span> <span class="title">UDF</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Text res = <span class="keyword">new</span> Text();</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Text <span class="title">evaluate</span><span class="params">(String string)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 校验参数是否为空</span></span><br><span class="line">		<span class="keyword">if</span>(string==<span class="keyword">null</span>)&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">        <span class="comment">// 若为单个字符        </span></span><br><span class="line">		<span class="keyword">if</span>(string.length()==<span class="number">1</span>)&#123;</span><br><span class="line">			res.set(<span class="string">"*"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	  String str1 = string.substring(<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">	  String str2 = string.substring(string.length()-<span class="number">1</span>,string.length());</span><br><span class="line">	  res.set(str1+<span class="string">"***"</span>+str2);</span><br><span class="line">	  <span class="keyword">return</span> res;</span><br><span class="line">	  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>函数二：add函数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bigdata.hive.udf;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hive.ql.exec.UDF;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Add</span> <span class="keyword">extends</span> <span class="title">UDF</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Text res = <span class="keyword">new</span> Text();</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Text <span class="title">evaluate</span><span class="params">(String num1,String num2)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 校验参数是否为空</span></span><br><span class="line">		<span class="keyword">if</span>(num1==<span class="keyword">null</span>)&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(num2==<span class="keyword">null</span>)&#123;</span><br><span class="line">			res.set(num1);</span><br><span class="line">			<span class="keyword">return</span> res;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> n = Integer.parseInt(num1)+Integer.parseInt(num2);</span><br><span class="line">	    String str =n+<span class="string">""</span>;</span><br><span class="line">	    res.set(str);</span><br><span class="line">	    <span class="keyword">return</span> res;</span><br><span class="line">	  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  b）进入 hive 客户端，添加 jar 包</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hive&gt;add jar /root/su/TuoMing.jar;</span><br><span class="line">(相当于添加到环境变量中)</span><br><span class="line">(清除缓存时记得删除jar包： <span class="keyword">delete</span> jar <span class="comment">/*)</span></span><br><span class="line"><span class="comment">delete jar /jar/udf_test.jar;</span></span><br></pre></td></tr></table></figure>
<p>  c）创建临时函数：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hive&gt;CREATE TEMPORARY FUNCTION add_example AS 'hive.udf.add';</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TEMPORARY</span> <span class="keyword">FUNCTION</span> tm_example <span class="keyword">AS</span> <span class="string">'com.bigdata.hive.udf.TuoMing'</span>;</span><br><span class="line">（as 后面添加的是：包名+类名）</span><br></pre></td></tr></table></figure>
<p>  d）查询 HQL 语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  add_example(<span class="number">8</span>,<span class="number">9</span>)  <span class="keyword">FROM</span>  scores;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span>  add_example(scores.math,scores.art)  <span class="keyword">FROM</span>  scores;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span>  tm_example(<span class="keyword">id</span>)  <span class="keyword">FROM</span>  <span class="keyword">log</span>;</span><br></pre></td></tr></table></figure>
<p>  e）销毁临时函数：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive&gt;  DROP  TEMPORARY  FUNCTION  tm_example;</span><br></pre></td></tr></table></figure>
<h4 id="（2）UDAF自定义聚集函数-用的少"><a href="#（2）UDAF自定义聚集函数-用的少" class="headerlink" title="（2）UDAF自定义聚集函数(用的少)"></a>（2）UDAF自定义聚集函数(用的少)</h4><blockquote>
<p>多行进一行出，如 sum()、min()，用在 group  by 时</p>
</blockquote>
<p><strong>1.</strong>必须<code>继承</code>org.apache.hadoop.hive.ql.exec.<code>UDAF</code>(函数类继承)</p>
<p>org.apache.hadoop.hive.ql.exec.<code>UDAFEvaluator</code>(内部类 Evaluator 实现 UDAFEvaluator 接口)</p>
<p><strong>2.</strong>Evaluator 需要实现 <code>init、iterate、terminatePartial、merge、terminate</code> 这几个函数</p>
<blockquote>
<ul>
<li><p>init():类似于构造函数，用于 UDAF 的初始化</p>
</li>
<li><p>iterate():接收传入的参数，并进行内部的轮转，返回 boolean</p>
</li>
<li><p>terminatePartial():无参数，其为 iterate 函数轮转结束后，返回轮转数据，</p>
</li>
</ul>
<p>类似于 hadoop 的Combinermerge()：接收 terminatePartial 的返回结果，进行数据 merge 操作，</p>
<p>​                                                                  其返回类型为 boolean </p>
<ul>
<li>terminate():返回最终的聚集函数结果</li>
</ul>
</blockquote>
<p>开发一个功能同：</p>
<blockquote>
<p>Oracle 的 wm_concat()函数</p>
<p>Mysql 的 group_concat()</p>
</blockquote>
<blockquote>
<p>Hive  UDF 的数据类型：</p>
</blockquote>
<p><img src="https://ws1.sinaimg.cn/large/005zftzDgy1fz53mse6n1j30fe0c3jxm.jpg" alt="Hive  UDF 的数据类型："><span class="img-alt">Hive  UDF 的数据类型：</span></p>
<h4 id="（3）UDTF（用的少一点）"><a href="#（3）UDTF（用的少一点）" class="headerlink" title="（3）UDTF（用的少一点）"></a>（3）UDTF（用的少一点）</h4><p>UDTF：一进多出，如 lateral  view  explode( )  返回一个数组表</p>
<blockquote>
<p><strong>Hive Lateral View</strong>   视图</p>
<p>Lateral View用于和UDTF函数（explode、split）结合来使用。</p>
<p>首先通过UDTF函数拆分成多行，再将多行结果组合成一个支持别名的虚拟表。</p>
<p><code>主要解决</code></p>
<p>在select使用UDTF做查询过程中，查询只能包含单个UDTF，不能包含其他字段、以及多个UDTF的问题</p>
</blockquote>
<blockquote>
<p><code>语法：</code></p>
<p>LATERAL VIEW udtf(expression) tableAlias AS columnAlias (‘,’ columnAlias)</p>
</blockquote>
<blockquote>
<p><code>例：</code></p>
<p>统计人员表中共有多少种爱好、多少个城市?</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; select count(distinct(myCol1)), count(distinct(myCol2))，count(distinct(myCol3))from log2 </span><br><span class="line">&gt;       LATERAL VIEW explode(likes) myTable1 AS myCol1 </span><br><span class="line">&gt;       LATERAL VIEW explode(address) myTable2 AS myCol2, myCol3;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select myCol1, myCol2 from log2 </span><br><span class="line">      LATERAL VIEW explode(likes) myTable1 AS myCol1 </span><br><span class="line">      LATERAL VIEW explode(address) myTable2 AS myCol2, myCol3;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>distinct(myCol1) 表示去重</p>
</blockquote>
<blockquote>
<p>LATERAL VIEW explode(likes) myTable1   AS myCol1   </p>
<p>将likes查询结果放到mytable1表中，作为字段myCol1     </p>
</blockquote>
<blockquote>
<p> LATERAL VIEW explode(address) myTable2 AS myCol2, myCol3;</p>
<p>将address查询结果放到myTable2 表中，作为字段myCol2，myCol3，因为address是包含K-V的（两个）</p>
</blockquote>
<h2 id="八、Hive索引-知道"><a href="#八、Hive索引-知道" class="headerlink" title="八、Hive索引(知道)"></a>八、Hive索引(知道)</h2><blockquote>
<p>一个表上创建索引：</p>
<p>使用给定的列表的列作为键创建一个索引。</p>
<p>详见创建<a href="javascript:changelink(&#39;https://cwiki.apache.org/confluence/display/Hive/IndexDev#IndexDev-CREATEINDEX&#39;,&#39;EN2ZH_CN&#39;" target="_blank" rel="noopener">索引</a>;)设计文档。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> index_name</span><br><span class="line">  <span class="keyword">ON</span> <span class="keyword">TABLE</span> base_table_name (col_name, ...)</span><br><span class="line">  <span class="keyword">AS</span> index_type</span><br><span class="line">  [<span class="keyword">WITH</span> <span class="keyword">DEFERRED</span> <span class="keyword">REBUILD</span>]</span><br><span class="line">  [IDXPROPERTIES (property_name=property_value, ...)]</span><br><span class="line">  [<span class="keyword">IN</span> <span class="keyword">TABLE</span> index_table_name]</span><br><span class="line">  [</span><br><span class="line">     [ <span class="keyword">ROW</span> <span class="keyword">FORMAT</span> ...] <span class="keyword">STORED</span> <span class="keyword">AS</span> ...</span><br><span class="line">     | <span class="keyword">STORED</span> <span class="keyword">BY</span> ...</span><br><span class="line">  ]</span><br><span class="line">  [LOCATION hdfs_path]</span><br><span class="line">  [TBLPROPERTIES (...)]</span><br><span class="line">  [<span class="keyword">COMMENT</span> <span class="string">"index comment"</span>];</span><br></pre></td></tr></table></figure>
<h2 id="九、案例实践"><a href="#九、案例实践" class="headerlink" title="九、案例实践"></a>九、案例实践</h2><h3 id="案例一：-基站掉话率"><a href="#案例一：-基站掉话率" class="headerlink" title="案例一：(基站掉话率)"></a>案例一：(基站掉话率)</h3><p><img src="https://ws1.sinaimg.cn/large/005zftzDgy1fz53p74gyrj30fe07sab1.jpg" alt="基站掉话率"><span class="img-alt">基站掉话率</span></p>
<h4 id="1、创建表"><a href="#1、创建表" class="headerlink" title="1、创建表"></a>1、创建表</h4><p>cell_monitor表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">create table cell_monitor(</span><br><span class="line">        record_time string,</span><br><span class="line">        imei string,</span><br><span class="line">        cell string,</span><br><span class="line">        ph_num int,</span><br><span class="line">        call_num int,</span><br><span class="line">        drop_num int,</span><br><span class="line">        duration int,</span><br><span class="line">        drop_rate DOUBLE,</span><br><span class="line">        net_type string,</span><br><span class="line">        erl string</span><br><span class="line">)</span><br><span class="line">ROW FORMAT DELIMITED FIELDS TERMINATED BY &apos;,&apos;</span><br><span class="line">STORED AS TEXTFILE;</span><br></pre></td></tr></table></figure>
<p> 结果表cell_drop_monitor</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">create table cell_drop_monitor(</span><br><span class="line">imei string,</span><br><span class="line">total_call_num int,</span><br><span class="line">total_drop_num int,</span><br><span class="line">d_rate DOUBLE</span><br><span class="line">) </span><br><span class="line">ROW FORMAT DELIMITED FIELDS TERMINATED BY &apos;\t&apos;</span><br><span class="line">STORED AS TEXTFILE;</span><br></pre></td></tr></table></figure>
<h4 id="2、load数据"><a href="#2、load数据" class="headerlink" title="2、load数据"></a><strong>2</strong>、load<strong>数据</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LOAD DATA LOCAL INPATH &apos;/root/su/cdr_summ_imei_cell_info.csv&apos; OVERWRITE INTO TABLE cell_monitor;</span><br></pre></td></tr></table></figure>
<h4 id="3、找出掉线率最高的基站"><a href="#3、找出掉线率最高的基站" class="headerlink" title="3、找出掉线率最高的基站"></a><strong>3</strong>、找出掉线率最高的基站</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from cell_monitor cm </span><br><span class="line">insert overwrite table cell_drop_monitor  </span><br><span class="line">select cm.imei ,sum(cm.drop_num),sum(cm.duration),sum(cm.drop_num)/sum(cm.duration) d_rate </span><br><span class="line">group by cm.imei </span><br><span class="line">sort by d_rate desc;</span><br></pre></td></tr></table></figure>
<h3 id="案例二：（单词统计）"><a href="#案例二：（单词统计）" class="headerlink" title="案例二：（单词统计）"></a>案例二：（单词统计）</h3><h4 id="1、建表"><a href="#1、建表" class="headerlink" title="1、建表"></a><strong>1</strong>、建表</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create table docs(line string);</span><br><span class="line">create table wc(word string, totalword int);</span><br></pre></td></tr></table></figure>
<h4 id="2、加载数据"><a href="#2、加载数据" class="headerlink" title="2、加载数据"></a>2、加载数据</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load data local inpath &apos;/tmp/wc&apos; into table docs;</span><br></pre></td></tr></table></figure>
<h4 id="3、统计"><a href="#3、统计" class="headerlink" title="3、统计"></a>3、统计</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from (select explode(split(line, &apos; &apos;)) as word from docs) w </span><br><span class="line">insert into table wc </span><br><span class="line">  select word, count(1) as totalword </span><br><span class="line">  group by word </span><br><span class="line">  order by word;</span><br></pre></td></tr></table></figure>
<h4 id="4、查询结果"><a href="#4、查询结果" class="headerlink" title="4、查询结果"></a><strong>4</strong>、查询结果</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from wc;</span><br></pre></td></tr></table></figure>
<h2 id="十、-分桶（重要）"><a href="#十、-分桶（重要）" class="headerlink" title="十、==分桶（重要）=="></a>十、==分桶（重要）==</h2><h3 id="1、概念"><a href="#1、概念" class="headerlink" title="1、概念"></a>1、概念</h3><blockquote>
<ul>
<li><p>主要应用于<code>数据抽样</code>。</p>
</li>
<li><p>通过对<code>列值取哈希</code>值的方式，将不同数据放到不同的文件中存储。</p>
</li>
<li><p>对Hive中每个<code>表</code>、<code>分区</code>都可以进行分桶。</p>
</li>
<li><p>列的哈希值 /桶的个数→<code>决定</code>每条数据划分到哪个桶中</p>
</li>
</ul>
</blockquote>
<h3 id="2、开启支持分桶"><a href="#2、开启支持分桶" class="headerlink" title="2、开启支持分桶"></a>2、开启支持分桶</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive&gt; set hive.enforce.bucketing=true;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>默认：false；</p>
<p>设置为true之后，mr运行时会根据bucket的个数自动分配reduce task个数。</p>
<p>（用户也可以通过mapred.reduce.tasks自己设置reduce任务个数，但分桶时不推荐使用）</p>
<p><strong>一次作业产生的桶数 = reducde task数</strong></p>
</blockquote>
<h3 id="3、往分桶表中加载数据"><a href="#3、往分桶表中加载数据" class="headerlink" title="3、往分桶表中加载数据"></a>3、往分桶表中加载数据</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> bucket_table <span class="keyword">select</span> <span class="keyword">columns</span> <span class="keyword">from</span> tbl;</span><br><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">table</span> bucket_table <span class="keyword">select</span> <span class="keyword">columns</span> <span class="keyword">from</span> tbl;</span><br></pre></td></tr></table></figure>
<h3 id="4、桶表"><a href="#4、桶表" class="headerlink" title="4、桶表"></a>4、桶表</h3><h3 id="抽样查询"><a href="#抽样查询" class="headerlink" title="抽样查询"></a>抽样查询</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> bucket_table tablesample(bucket <span class="number">1</span> <span class="keyword">out</span> <span class="keyword">of</span> <span class="number">4</span> <span class="keyword">on</span> <span class="keyword">columns</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>TABLESAMPLE语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; TABLESAMPLE(BUCKET x OUT OF y)</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>x：表示从哪个bucket开始抽取数据，<code>x&lt;=y</code></p>
<p>y：必须为该表总bucket数的<code>倍数</code>或<code>因子</code></p>
<p>理解：</p>
<p>分桶表已经按age分为4桶，然后，有y个人去抽，从第(x 取模 桶数)桶中抽</p>
</blockquote>
<h3 id="5、实战"><a href="#5、实战" class="headerlink" title="5、实战"></a>5、实战</h3><p>创建普通表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> mm( </span><br><span class="line"><span class="keyword">id</span> <span class="built_in">INT</span>, </span><br><span class="line"><span class="keyword">name</span> <span class="keyword">STRING</span>, </span><br><span class="line">age <span class="built_in">INT</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> <span class="keyword">DELIMITED</span> <span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">','</span>;</span><br></pre></td></tr></table></figure>
<p>测试数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1,tom,11</span><br><span class="line">2,cat,22</span><br><span class="line">3,dog,33</span><br><span class="line">4,hive,44</span><br><span class="line">5,hbase,55</span><br><span class="line">6,mr,66</span><br><span class="line">7,alice,77</span><br><span class="line">8,scala,88</span><br></pre></td></tr></table></figure>
<p>加载数据：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load data local inpath '/root/su/mm' into table mm;</span><br></pre></td></tr></table></figure>
<p><strong>创建分桶表</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> psnbucket( </span><br><span class="line"><span class="keyword">id</span> <span class="built_in">INT</span>, </span><br><span class="line"><span class="keyword">name</span> <span class="keyword">STRING</span>, </span><br><span class="line">age <span class="built_in">INT</span></span><br><span class="line">)</span><br><span class="line">CLUSTERED <span class="keyword">BY</span> (age) <span class="keyword">INTO</span> <span class="number">4</span> BUCKETS </span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> <span class="keyword">DELIMITED</span> <span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">','</span>;</span><br></pre></td></tr></table></figure>
<p><strong>加载数据：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> psnbucket <span class="keyword">select</span> <span class="keyword">id</span>, <span class="keyword">name</span>, age <span class="keyword">from</span> mm;</span><br></pre></td></tr></table></figure>
<p><strong>抽样</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>, <span class="keyword">name</span>, age <span class="keyword">from</span> psnbucket tablesample(bucket <span class="number">2</span> <span class="keyword">out</span> <span class="keyword">of</span> <span class="number">4</span> <span class="keyword">on</span> age);</span><br></pre></td></tr></table></figure>
<p><code>注意：</code></p>
<blockquote>
<p> hive&gt; select id, name, age from psnbucket tablesample(bucket 4 out of 2 on age);<br>FAILED: SemanticException [Error 10061]: Numerator should not be bigger than denominator in sample clause for table psnbucket</p>
<p>denominator  : 分母</p>
</blockquote>
<h2 id="十一、运行方式"><a href="#十一、运行方式" class="headerlink" title="十一、运行方式"></a>十一、运行方式</h2><h3 id="1、Hive运行模式"><a href="#1、Hive运行模式" class="headerlink" title="1、Hive运行模式"></a>1、Hive运行模式</h3><blockquote>
<h4 id="–-命令行方式cli：控制台模式"><a href="#–-命令行方式cli：控制台模式" class="headerlink" title="– 命令行方式cli：控制台模式"></a>– 命令行方式cli：控制台模式</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">--与hdfs交互</span><br><span class="line">  * 执行dfs命令</span><br><span class="line">  * 例 ：hive&gt; dfs -ls /</span><br><span class="line">  </span><br><span class="line">--与Linux交互</span><br><span class="line">   *  ！ 开头</span><br><span class="line">   *  hive&gt; !pwd</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="–脚本运行方式：（生产中常用）"><a href="#–脚本运行方式：（生产中常用）" class="headerlink" title="–脚本运行方式：（生产中常用）"></a>–脚本运行方式：（生产中常用）</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">在外部shell中执行,指定数据库,分号可加可不加</span><br><span class="line"># hive -e &quot;select * from attr.log &quot;</span><br><span class="line"># hive -e &quot;select * from attr.log；select * from default.log2&quot;</span><br><span class="line">--------------------------------------------------------------</span><br><span class="line">将执行结果重定向到指定文件：</span><br><span class="line"># hive -e &quot;select * from attr.log &quot; &gt;&gt;log1</span><br><span class="line">--------------------------------------------------------------</span><br><span class="line">静默模式执行，不打印log日志</span><br><span class="line"># hive -S -e &quot;select * from attr.log &quot; &gt;&gt;log1</span><br><span class="line">--------------------------------------------------------------</span><br><span class="line">脚本执行</span><br><span class="line">先编辑脚本问价</span><br><span class="line"># vim file1</span><br><span class="line">编辑内容</span><br><span class="line">select * from attr.log where id = 1;</span><br><span class="line">select * from attr.log where id &lt; 3;</span><br><span class="line">执行脚本</span><br><span class="line"># hive -f file1</span><br><span class="line">--------------------------------------------------------------</span><br><span class="line">?? 使用命令文件执行hive-init.sql</span><br><span class="line">?? # hive -i /home/hive-init.sql</span><br><span class="line">--------------------------------------------------------------</span><br><span class="line">在hive cli中执行脚本文件</span><br><span class="line">hive&gt; source file1</span><br></pre></td></tr></table></figure>
<h3 id="？未解决？"><a href="#？未解决？" class="headerlink" title="？未解决？"></a>？未解决？</h3><blockquote>
<p>?? 使用命令文件执行hive-init.sql<br>?? # hive -i /home/hive-init.sql</p>
</blockquote>
<h2 id="十二、hive的GUI接口（web页面）"><a href="#十二、hive的GUI接口（web页面）" class="headerlink" title="十二、hive的GUI接口（web页面）"></a>十二、hive的GUI接口（web页面）</h2><p>Hive Web GUI接口</p>
<h3 id="web界面安装："><a href="#web界面安装：" class="headerlink" title="web界面安装："></a>web界面安装：</h3><p><strong>1、</strong>下载源码包apache-hive-1.2.1-src.tar.gz,</p>
<p><strong>2、</strong>在本地Windows系统中解压</p>
<p>并将\apache-hive-1.2.1-src\hwi\web路径中所有的文件打成war包</p>
<p><code>制作方法：</code></p>
<p><img src="https://ws1.sinaimg.cn/large/005zftzDgy1fz5b7di85fj30rn0eodhm.jpg" alt="war包"><span class="img-alt">war包</span></p>
<blockquote>
<p>1、到\apache-hive-1.2.1-src\hwi\web路径下</p>
<p>2、在路径栏输入命令：jar -cvf hive-hwi.war *</p>
<p>3、即可生成文件：hive-hwi.war</p>
</blockquote>
<p><strong>3、</strong>将hwi-war包放在$HIVE_HOME/lib/中（Linux系统）</p>
<p><strong>4、</strong>复制tools.jar(在jdk的lib目录下)到$HIVE_HOME/lib下</p>
<p><strong>5、</strong>修改hive-site.xml</p>
<p>路径：/usr/soft/apache-hive-1.2.1-bin/conf/hive-site.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.hwi.listen.host<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>0.0.0.0<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.hwi.listen.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>9999<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.hwi.war.file<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>lib/hive-hwi.war<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>6、</strong>启动hwi服务(端口号9999)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive --service hwi</span><br></pre></td></tr></table></figure>
<p><strong>7、</strong>浏览器通过以下链接来访问</p>
<p><a href="http://node00:9999/hwi/" target="_blank" rel="noopener">http://node00:9999/hwi/</a></p>
<p><strong>8、</strong>登录页面：</p>
<p>USER:</p>
<p>GROUPS:</p>
<p>自已定义</p>
<h2 id="十三、权限管理"><a href="#十三、权限管理" class="headerlink" title="十三、权限管理"></a>十三、权限管理</h2><p>Hive - SQL Standards Based Authorization in  HiveServer2</p>
<h3 id="（1）三种授权模型"><a href="#（1）三种授权模型" class="headerlink" title="（1）三种授权模型"></a>（1）三种授权模型</h3><p><img src="https://ws1.sinaimg.cn/large/005zftzDgy1fz5bus4ks8j30kb08o3zp.jpg" alt=""></p>
<h3 id="（2）常用：基于SQL标准的完全兼容SQL的授权模型"><a href="#（2）常用：基于SQL标准的完全兼容SQL的授权模型" class="headerlink" title="（2）常用：基于SQL标准的完全兼容SQL的授权模型"></a>（2）常用：基于SQL标准的完全兼容SQL的授权模型</h3><p>特点：</p>
<ul>
<li><p>支持对于用户的授权认证</p>
</li>
<li><p>支持角色role的授权认证</p>
</li>
<li><p>role可理解为是一组权限的集合，通过role为用户授权</p>
<p> 一个用户可以具有一个或多个角色</p>
<p>​    默认包含俩种角色：public、admin</p>
</li>
</ul>
<p><img src="https://ws1.sinaimg.cn/large/005zftzDgy1fz5c0cf550j30k406tjtk.jpg" alt="限制"><span class="img-alt">限制</span></p>
<h3 id="（3）操作"><a href="#（3）操作" class="headerlink" title="（3）操作"></a>（3）操作</h3><p>在<code>hive服务端</code>修改配置文件hive-site.xml添加以下配置内容：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.security.authorization.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.enable.doAs<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.users.in.admin.role<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>root<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.security.authorization.manager<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.hadoop.hive.ql.security.authorization.plugin.sqlstd.SQLStdHiveAuthorizerFactory<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.security.authenticator.manager<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.hadoop.hive.ql.security.SessionStateUserAuthenticator<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>服务端启动hiveserver2；客户端通过beeline进行连接</strong></p>
<p>角色的添加、删除、查看、设置：</p>
<p>第一次操作无权限：</p>
<p>需要：CREATE ROLE  admin；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE ROLE role_name;  			 -- 创建角色</span><br><span class="line">DROP ROLE role_name;  				 -- 删除角色</span><br><span class="line">SET ROLE (role_name|ALL|NONE); 		 -- 设置角色</span><br><span class="line">SHOW CURRENT ROLES;    				 -- 查看当前具有的角色</span><br><span class="line">SHOW ROLES;    				         -- 查看所有存在的角色</span><br></pre></td></tr></table></figure>
<p><img src="https://ws1.sinaimg.cn/large/005zftzDgy1fz5c6wynhnj30hs07kgmv.jpg" alt=""></p>
<p><img src="https://ws1.sinaimg.cn/large/005zftzDgy1fz5c8bvsjkj30im077wft.jpg" alt=""></p>
<p>【官网：权限】</p>
<table>
<thead>
<tr>
<th>Action</th>
<th>Select</th>
<th>Insert</th>
<th>Update</th>
<th>Delete</th>
<th>Owership</th>
<th>Admin</th>
<th>URL Privilege(RWX   Permission + Ownership)</th>
</tr>
</thead>
<tbody>
<tr>
<td>ALTER DATABASE</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Y</td>
<td></td>
</tr>
<tr>
<td>ALTER INDEX PROPERTIES</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Y</td>
<td></td>
<td></td>
</tr>
<tr>
<td>ALTER INDEX REBUILD</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Y</td>
<td></td>
<td></td>
</tr>
<tr>
<td>ALTER PARTITION LOCATION</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Y</td>
<td></td>
<td>Y (for new partition   location)</td>
</tr>
<tr>
<td>ALTER TABLE (all of them   except the ones above)</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Y</td>
<td></td>
<td></td>
</tr>
<tr>
<td>ALTER TABLE ADD PARTITION</td>
<td></td>
<td>Y</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Y (for partition location)</td>
</tr>
<tr>
<td>ALTER TABLE DROP PARTITION</td>
<td></td>
<td></td>
<td></td>
<td>Y</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>ALTER TABLE LOCATION</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Y</td>
<td></td>
<td>Y (for new location)</td>
</tr>
<tr>
<td>ALTER VIEW PROPERTIES</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Y</td>
<td></td>
<td></td>
</tr>
<tr>
<td>ALTER VIEW RENAME</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Y</td>
<td></td>
<td></td>
</tr>
<tr>
<td>ANALYZE TABLE</td>
<td>Y</td>
<td>Y</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>CREATE DATABASE</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Y (if custom location   specified)</td>
</tr>
<tr>
<td>CREATE FUNCTION</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Y</td>
<td></td>
</tr>
<tr>
<td>CREATE INDEX</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Y (of table)</td>
<td></td>
<td></td>
</tr>
<tr>
<td>CREATE MACRO</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Y</td>
<td></td>
</tr>
<tr>
<td>CREATE TABLE</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Y (of database)</td>
<td></td>
<td>Y  (for create   external table – the location)</td>
</tr>
<tr>
<td>CREATE TABLE AS SELECT</td>
<td>Y (of input)</td>
<td></td>
<td></td>
<td></td>
<td>Y (of database)</td>
<td></td>
<td></td>
</tr>
<tr>
<td>CREATE VIEW</td>
<td>Y + G</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>DELETE</td>
<td></td>
<td></td>
<td></td>
<td>Y</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>DESCRIBE TABLE</td>
<td>Y</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>DROP DATABASE</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Y</td>
<td></td>
<td></td>
</tr>
<tr>
<td>DROP FUNCTION</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Y</td>
<td></td>
</tr>
<tr>
<td>DROP INDEX</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Y</td>
<td></td>
<td></td>
</tr>
<tr>
<td>DROP MACRO</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Y</td>
<td></td>
</tr>
<tr>
<td>DROP TABLE</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Y</td>
<td></td>
<td></td>
</tr>
<tr>
<td>DROP VIEW</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Y</td>
<td></td>
<td></td>
</tr>
<tr>
<td>DROP VIEW PROPERTIES</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Y</td>
<td></td>
<td></td>
</tr>
<tr>
<td>EXPLAIN</td>
<td>Y</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>INSERT</td>
<td></td>
<td>Y</td>
<td></td>
<td>Y (for OVERWRITE)</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>LOAD</td>
<td></td>
<td>Y (output)</td>
<td></td>
<td>Y (output)</td>
<td></td>
<td></td>
<td>Y (input location)</td>
</tr>
<tr>
<td>MSCK (metastore check)</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Y</td>
<td></td>
</tr>
<tr>
<td>SELECT</td>
<td>Y</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>SHOW COLUMNS</td>
<td>Y</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>SHOW CREATE TABLE</td>
<td>Y+G</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>SHOW PARTITIONS</td>
<td>Y</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>SHOW TABLE PROPERTIES</td>
<td>Y</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>SHOW TABLE STATUS</td>
<td>Y</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>TRUNCATE TABLE</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Y</td>
<td></td>
<td></td>
</tr>
<tr>
<td>UPDATE</td>
<td></td>
<td></td>
<td>Y</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="十四、-Hive优化（重点）"><a href="#十四、-Hive优化（重点）" class="headerlink" title="十四、==Hive优化（重点）=="></a>十四、==Hive优化（重点）==</h2><p><code>详见Hive优化文档</code></p>
<h1 id="hive-参数与变量"><a href="#hive-参数与变量" class="headerlink" title="hive 参数与变量"></a>hive 参数与变量</h1><h2 id="1、hive当中的参数、变量"><a href="#1、hive当中的参数、变量" class="headerlink" title="1、hive当中的参数、变量"></a>1、hive当中的参数、变量</h2><p>hive当中的参数、变量，都是以命名空间开头</p>
<table>
<thead>
<tr>
<th style="text-align:center">命名空间</th>
<th style="text-align:center">读写权限</th>
<th style="text-align:center">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">hiveconf</td>
<td style="text-align:center">可读写</td>
<td style="text-align:center">hive-site.xml当中的各配置变量<br>例：hive –hiveconf hive.cli.print.header=true</td>
</tr>
<tr>
<td style="text-align:center">system</td>
<td style="text-align:center">可读写</td>
<td style="text-align:center">系统变量，包含JVM运行参数<br>例：system:user.name=root</td>
</tr>
<tr>
<td style="text-align:center">env</td>
<td style="text-align:center">只读</td>
<td style="text-align:center">环境变量<br>例：env:JAVA_HOME</td>
</tr>
<tr>
<td style="text-align:center">hivevar</td>
<td style="text-align:center">可读写</td>
<td style="text-align:center">例：hive -d val=key</td>
</tr>
</tbody>
</table>
<p>通过${}方式进行引用，其中system、env下的变量必须以前缀开头</p>
<h2 id="2、hive-参数设置方式"><a href="#2、hive-参数设置方式" class="headerlink" title="2、hive 参数设置方式"></a>2、hive 参数设置方式</h2><p>1、修改配置文件 ${HIVE_HOME}/conf/hive-site.xml</p>
<p>2、启动hive cli时，通过–hiveconf key=value的方式进行设置</p>
<p>例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive --hiveconf hive.cli.print.header=true</span><br></pre></td></tr></table></figure>
<p>3、进入cli之后，通过使用set命令设置</p>
<h2 id="3、hive-set命令"><a href="#3、hive-set命令" class="headerlink" title="3、hive set命令"></a>3、hive set命令</h2><p>-    在hive CLI控制台可以通过set对hive中的参数进行查询、设置</p>
<p>-    set设置：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> hive.cli.print.header=<span class="literal">true</span>;</span><br></pre></td></tr></table></figure>
<p>-     set查看</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> hive.cli.print.header</span><br></pre></td></tr></table></figure>
<p>-     hive参数初始化配置</p>
<p>当前用户家目录下的.hiverc文件</p>
<p>如:  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/.hiverc</span><br></pre></td></tr></table></figure>
<p>如果没有，可直接创建该文件，将需要设置的参数写到该文件中，hive启动运行时，会加载改文件中的配置。</p>
<p>-     hive历史操作命令集</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/.hivehistory</span><br></pre></td></tr></table></figure>
<p>Hive常用函数：</p>
<p><a href="https://www.cnblogs.com/kimbo/p/6288516.html" target="_blank" rel="noopener">https://www.cnblogs.com/kimbo/p/6288516.html</a></p>
<p><a href="https://www.iteblog.com/archives/2258.html#3_avg" target="_blank" rel="noopener">https://www.iteblog.com/archives/2258.html#3_avg</a></p>
<p><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF#LanguageManualUDF-Built-inFunctions" target="_blank" rel="noopener">https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF#LanguageManualUDF-Built-inFunctions</a></p>
<p>MapReducde底层源码：</p>
<ol>
<li><a href="http://note.youdao.com/noteshare?id=212e4a69d7bf8fc30979f1e4fc39ff0f&amp;sub=EA7C15DC72DF45248721CE2AD3F93CDD" target="_blank" rel="noopener">http://note.youdao.com/noteshare?id=212e4a69d7bf8fc30979f1e4fc39ff0f&amp;sub=EA7C15DC72DF45248721CE2AD3F93CDD</a></li>
<li><a href="http://note.youdao.com/noteshare?id=86ca5c96d13413f789164ff92f9ab4f9&amp;sub=7F20006D1D714D77AEDE5242603786C1" target="_blank" rel="noopener">http://note.youdao.com/noteshare?id=86ca5c96d13413f789164ff92f9ab4f9&amp;sub=7F20006D1D714D77AEDE5242603786C1</a></li>
<li><a href="http://note.youdao.com/noteshare?id=a518dfed10d824b0995380669ddd28c9&amp;sub=3526F532CDAA49628FEA1FE3A61239F3" target="_blank" rel="noopener">http://note.youdao.com/noteshare?id=a518dfed10d824b0995380669ddd28c9&amp;sub=3526F532CDAA49628FEA1FE3A61239F3</a></li>
<li><a href="http://note.youdao.com/noteshare?id=95d458d779f8e9f391d6ea06b6c6d122&amp;sub=0A13B59E10D94C96ABF5388CE4EB89D4" target="_blank" rel="noopener">http://note.youdao.com/noteshare?id=95d458d779f8e9f391d6ea06b6c6d122&amp;sub=0A13B59E10D94C96ABF5388CE4EB89D4</a></li>
</ol>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2019/01/11/Hive学习/">Hive学习</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">Sukie</a></p>
        <p><span>发布时间:</span>2019-01-11, 00:00:00</p>
        <p><span>最后更新:</span>2019-03-27, 23:10:27</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2019/01/11/Hive学习/" title="Hive学习">http://sungithup.github.io/2019/01/11/Hive学习/</a>
            <span class="copy-path" data-clipboard-text="原文: http://sungithup.github.io/2019/01/11/Hive学习/　　作者: Sukie" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target="_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2019/01/12/Hive中常用的UDF函数总结/">
                    Hive中常用的UDF函数总结
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2019/01/08/MapReduce源码分析/">
                    MapReduce源码分析
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一、Hive是什么？"><span class="toc-text">一、Hive是什么？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、基于-Hadoop-的一个数据仓库工具"><span class="toc-text">1、基于 Hadoop 的一个数据仓库工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、快速实现简单的MapReduce-统计的工具"><span class="toc-text">2、快速实现简单的MapReduce 统计的工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3、什么是数据仓库？"><span class="toc-text">3、什么是数据仓库？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4、数据处理的两大分类"><span class="toc-text">4、数据处理的两大分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#联机事务处理OLTP（on-line-transaction-processing）"><span class="toc-text">联机事务处理OLTP（on-line transaction processing）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#联机分析处理OLAP（On-Line-Analytical-Processing）"><span class="toc-text">联机分析处理OLAP（On-Line Analytical Processing）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、Hive架构原理"><span class="toc-text">二、Hive架构原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三、Hive搭建及三种模式"><span class="toc-text">三、Hive搭建及三种模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、Hive的安装配置："><span class="toc-text">1、Hive的安装配置：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#（1）基本环境：Hadoop集群环境（至少3个节点）"><span class="toc-text">（1）基本环境：Hadoop集群环境（至少3个节点）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（2）安装一个关系型数据mysql"><span class="toc-text">（2）安装一个关系型数据mysql</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（3）解压安装（按需在指定节点上）"><span class="toc-text">（3）解压安装（按需在指定节点上）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（4）追加配置环境变量"><span class="toc-text">（4）追加配置环境变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（5）替换和添加相关jar包"><span class="toc-text">（5）替换和添加相关jar包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（6）修改配置文件（选择3种模式里哪一种）"><span class="toc-text">（6）修改配置文件（选择3种模式里哪一种）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（7）启动"><span class="toc-text">（7）启动</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、三种模式"><span class="toc-text">2、三种模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#（1）内嵌Derby单用户模式（了解）"><span class="toc-text">（1）内嵌Derby单用户模式（了解）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（2）本地用户模式（重要，多用于本地开发测试）"><span class="toc-text">（2）本地用户模式（重要，多用于本地开发测试）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（3）远程模式（重要）"><span class="toc-text">（3）远程模式（重要）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#remote-一体"><span class="toc-text">remote 一体</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Remote-分开-公司企业经常用"><span class="toc-text">Remote 分开(公司企业经常用)</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#四、HQL详解"><span class="toc-text">四、HQL详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、DDL语句（数据库定义语言）"><span class="toc-text">1、DDL语句（数据库定义语言）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#（1）具体参见：https-cwiki-apache-org-confluence-display-Hive-LanguageManual-DDL"><span class="toc-text">（1）具体参见：https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（2）创建-删除-修改-使用数据库"><span class="toc-text">（2）创建/删除/修改/使用数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#创建数据库"><span class="toc-text">创建数据库</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#删除数据库"><span class="toc-text">删除数据库</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#使用数据库-（进入某一数据库。如果没有这步操作，会进入默认default数据库）"><span class="toc-text">使用数据库 （进入某一数据库。如果没有这步操作，会进入默认default数据库）</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（3）创建-删除-表（重点）"><span class="toc-text">（3）创建/删除/表（重点）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#创建表（重要！）"><span class="toc-text">==创建表（重要！）==</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1、准备数据"><span class="toc-text">1、准备数据</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2、创建表"><span class="toc-text">2、创建表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3、删除表"><span class="toc-text">3、删除表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#创建外部表（重要）"><span class="toc-text">创建外部表（重要）</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（4）修改表-更新，删除数据-这些很少用"><span class="toc-text">（4）修改表,更新，删除数据(这些很少用)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、DML语句（数据库管理语言）"><span class="toc-text">2、DML语句（数据库管理语言）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#（1）具体参见："><span class="toc-text">（1）具体参见：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（2）四种插入-导入数据-重要"><span class="toc-text">（2）四种插入/导入数据(重要)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-直接加载数据"><span class="toc-text">1.直接加载数据</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-将表1查询结果插入表2"><span class="toc-text">2.将表1查询结果插入表2</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-将表1、表2查询结果插入表3、表4"><span class="toc-text">3.将表1、表2查询结果插入表3、表4</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-直接列出数据插入表中（大量数据时不推荐）"><span class="toc-text">4.直接列出数据插入表中（大量数据时不推荐）</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（3）查询数据并保存"><span class="toc-text">（3）查询数据并保存</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#保存数据到本地："><span class="toc-text">保存数据到本地：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#保存数据到HDFS上："><span class="toc-text">保存数据到HDFS上：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#在外部shell中将数据重定向到文件中："><span class="toc-text">在外部shell中将数据重定向到文件中：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（4）备份数据或还原数据（在HDFS上）"><span class="toc-text">（4）备份数据或还原数据（在HDFS上）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（5）其他Hql操作"><span class="toc-text">（5）其他Hql操作</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Hive的group-by-join-left-join-right-join等-having-sort-by-order-by等操作和MySQL没有什么大的区别："><span class="toc-text">Hive的group by\join(left join right join等)\having\sort by \order by等操作和MySQL没有什么大的区别：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3、Hive-SerDe（序列化、反序列化）"><span class="toc-text">3、Hive SerDe（序列化、反序列化）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-定义"><span class="toc-text">(1)定义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（2）实现"><span class="toc-text">（2）实现</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#五、Beeline和Hiveserver2（Hive的升级）"><span class="toc-text">五、Beeline和Hiveserver2（Hive的升级）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1、Hiveserver2直接启动（只能在服务端启动，相当于服务端）"><span class="toc-text">1、Hiveserver2直接启动（只能在服务端启动，相当于服务端）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2、启动-beeline（可在服务端-客户端启动，相当于客户端）"><span class="toc-text">2、启动 beeline（可在服务端|客户端启动，相当于客户端）</span></a></li></ol></li></ol><li class="toc-item toc-level-2"><a class="toc-link" href="#六、Hive的JDBC"><span class="toc-text">六、Hive的JDBC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#七、-Hive分区与自定义函数UDF-UDAF-UDTF"><span class="toc-text">七、==Hive分区与自定义函数UDF  UDAF UDTF==</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、-Hive的分区partition（重要）"><span class="toc-text">1、==Hive的分区partition（重要）==</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#（1）创建分区"><span class="toc-text">（1）创建分区</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#单分区建表"><span class="toc-text">单分区建表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#双分区建表"><span class="toc-text">双分区建表</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（2）添加分区表的分区"><span class="toc-text">（2）添加分区表的分区</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（3）删除分区"><span class="toc-text">（3）删除分区</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（4）数据加载进分区表中"><span class="toc-text">（4）数据加载进分区表中</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（5）查看表的所有分区"><span class="toc-text">（5）查看表的所有分区</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（6）重命名分区"><span class="toc-text">（6）重命名分区</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（7）-动态分区-重要-–注意外部表"><span class="toc-text">（7）==动态分区(重要)–注意外部表==</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、自定义函数UDF-UDAF-UDTF"><span class="toc-text">2、自定义函数UDF  UDAF UDTF</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#（1）UDF-开发（用的多一点）"><span class="toc-text">（1）UDF 开发（用的多一点）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（2）UDAF自定义聚集函数-用的少"><span class="toc-text">（2）UDAF自定义聚集函数(用的少)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（3）UDTF（用的少一点）"><span class="toc-text">（3）UDTF（用的少一点）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#八、Hive索引-知道"><span class="toc-text">八、Hive索引(知道)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#九、案例实践"><span class="toc-text">九、案例实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#案例一：-基站掉话率"><span class="toc-text">案例一：(基站掉话率)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1、创建表"><span class="toc-text">1、创建表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2、load数据"><span class="toc-text">2、load数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3、找出掉线率最高的基站"><span class="toc-text">3、找出掉线率最高的基站</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#案例二：（单词统计）"><span class="toc-text">案例二：（单词统计）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1、建表"><span class="toc-text">1、建表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2、加载数据"><span class="toc-text">2、加载数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3、统计"><span class="toc-text">3、统计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4、查询结果"><span class="toc-text">4、查询结果</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#十、-分桶（重要）"><span class="toc-text">十、==分桶（重要）==</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、概念"><span class="toc-text">1、概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、开启支持分桶"><span class="toc-text">2、开启支持分桶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3、往分桶表中加载数据"><span class="toc-text">3、往分桶表中加载数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4、桶表"><span class="toc-text">4、桶表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#抽样查询"><span class="toc-text">抽样查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5、实战"><span class="toc-text">5、实战</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#十一、运行方式"><span class="toc-text">十一、运行方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、Hive运行模式"><span class="toc-text">1、Hive运行模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#–-命令行方式cli：控制台模式"><span class="toc-text">– 命令行方式cli：控制台模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#–脚本运行方式：（生产中常用）"><span class="toc-text">–脚本运行方式：（生产中常用）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#？未解决？"><span class="toc-text">？未解决？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#十二、hive的GUI接口（web页面）"><span class="toc-text">十二、hive的GUI接口（web页面）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web界面安装："><span class="toc-text">web界面安装：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#十三、权限管理"><span class="toc-text">十三、权限管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（1）三种授权模型"><span class="toc-text">（1）三种授权模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（2）常用：基于SQL标准的完全兼容SQL的授权模型"><span class="toc-text">（2）常用：基于SQL标准的完全兼容SQL的授权模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（3）操作"><span class="toc-text">（3）操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#十四、-Hive优化（重点）"><span class="toc-text">十四、==Hive优化（重点）==</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#hive-参数与变量"><span class="toc-text">hive 参数与变量</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1、hive当中的参数、变量"><span class="toc-text">1、hive当中的参数、变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2、hive-参数设置方式"><span class="toc-text">2、hive 参数设置方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3、hive-set命令"><span class="toc-text">3、hive set命令</span></a></li></ol>
        
    </li></div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录" title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"Hive学习　| Sukie山脉　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    	


  
     
     




    <div class="scroll" id="post-nav-button">
        
            <a href="/2019/01/12/Hive中常用的UDF函数总结/" title="上一篇: Hive中常用的UDF函数总结">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2019/01/08/MapReduce源码分析/" title="下一篇: MapReduce源码分析">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/02/22/Spark学习（六）/">Spark学习（六）</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/21/Spark学习（五）/">Spark学习（五）</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/19/Spark学习（四）/">Spark学习（四）</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/18/Spark学习（三）/">Spark学习（三）</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/17/Spark学习（二）/">Spark学习（二）</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/16/Spark学习（一）/">Spark学习（一）</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/16/Set方法/">Set方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/16/面试问题总结/">面试问题总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/16/String方法/">String 方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/16/数组方法/">数组方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/16/List方法/">List方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/16/Map方法/">Map方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/15/Scala学习/">Scala学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/14/Redis学习/">Redis学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/29/Storm学习/">Storm学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/25/Elasticsearch学习/">Elasticsearch学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/18/Flume学习/">Flume学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/18/CDH操作学习/">CDH部署操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/17/HBase性能优化/">HBase性能优化</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/15/HBase学习/">HBase学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/13/Sqoop学习/">Sqoop学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/12/Hive优化/">Hive优化</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/12/Hive中常用的UDF函数总结/">Hive中常用的UDF函数总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/11/Hive学习/">Hive学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/08/MapReduce源码分析/">MapReduce源码分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/07/MapReduce案例分析/">MapReduce案例实践</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/05/MapReduce学习/">MapReduce学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/04/Zookeeper学习/">Zookeeper学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/04/Yarn学习/">YARN的入门学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/03/Hadoop2.X/">Hadoop2.X</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/03/HDFS学习/">HDFS学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/02/Nginx入门学习2/">Nginx入门学习（二）</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/02/Nginx入门学习1/">Nginx入门学习（一）</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/30/大数据思想/">大数据思想</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/29/常用Linux命令的学习3/">常用Linux命令的学习（三）</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/28/常用Linux命令的学习2/">常用Linux命令的学习（二）</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/27/常用Linux命令的学习1/">常用Linux命令的学习（一）</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/26/Linux系统数据库MySQL安装/">Linux系统数据库MySQL安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/25/Linux系统CentOS 6安装/">Linux学习之CentOS 6系统安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/24/手动安装maven坐标依赖/">手动安装maven坐标依赖</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/19/hello-world/">Hello World</a></li></ul>




    <script>
        
    </script>


<!--gitment 评论-->

  <div class="comments" id="comments">
  
  <!--汉化-->
    <link rel="stylesheet" href="https://billts.site/extra_css/gitment.css">
  <script src="https://billts.site/js/gitment.js"></script>
  <!--原型-->
  <!--
  <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
  <script src="https://imsun.github.io/gitment/dist/gitment.browser.js" type="text/javascript"></script>
  -->
  
      <div id="gitmentContainer" style="margin-bottom: -19px;"></div>
     
      <style>
        .gitment-container a {
          border: none;
        }
        .comments {
          margin: 60px 0 0;padding: 0 60px;
        }
      </style>
     
      <script type="text/javascript">
        var gitment = new Gitment({
        id: 'Fri Jan 11 2019 00:00:00 GMT+0800',
        title: 'Hive学习',
        owner: 'sungithup',
        repo: 'sungithup.github.io',
        oauth: {
        client_id: '80107df5bc27be1c1495',
        client_secret: 'c7949e6fc532f63f30f14fe1aff7f4b9c234860e',
        },
        })
        gitment.render('gitmentContainer')
      </script>
  </div>

<!--gitment 评论 end--></div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                
                2016-2019 Sukie
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style="display:none">
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style="display:none">
                        <span id="page-visit" title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        

        <span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span> 
        <script>
        var now = new Date(); 
        function createtime() { 
        var grt= new Date("02/14/2016 12:49:00");//此处修改你的建站时间或者网站上线时间 
        now.setTime(now.getTime()+250); 
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days); 
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours); 
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); 
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;} 
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;} 
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 "; 
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒"; 
        } 
        setInterval("createtime()",250);
        </script>

    </div>
</footer>
    </div>
    
    <script src="/js/GithubRepoWidget.js"></script>

<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





    <script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
             github: ".github-widget a", 
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

    <script>
        var originTitle = document.title;
        var titleTime;
        document.addEventListener("visibilitychange", function() {
            if (document.hidden) {
                document.title = "(つェ⊂) 我藏好了哦~ " + originTitle;
                clearTimeout(titleTime);
            }
            else {
                document.title = "(*´∇｀*) 被你发现啦~ " + originTitle;
                titleTime = setTimeout(function() {
                    document.title = originTitle;
                }, 2000);
            }
        })
    </script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<script typr="text/javascript" src="/resources/love.js"></script>
<script typr="text/javascript" src="/resources/float.js"></script>
<script typr="text/javascript" src="/resources/typewriter.js"></script>
<script typr="text/javascript" color="1,104,183" opacity="1" zindex="-1" count50="" src="/resources/particle.js"></script>
  </div>
</body>
</html>
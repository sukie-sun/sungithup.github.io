<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="keywords" content="hexo,ä¸ªäººåšå®¢,blog">
  <meta name="description" content="Sukieçš„ä¸ªäººåšå®¢">
  <meta http-equiv="x-dns-prefetch-control" content="on">
  <link rel="dns-prefetch" href="https://busuanzi.ibruce.info">
  
  <link rel="dns-prefetch" href="https://widget.daovoice.io">
  <link rel="dns-prefetch" href="https://widget-static-cdn.daovoice.io">
  <link rel="dns-prefetch" href="https://im.daovoice.io">
  
  
  <link rel="dns-prefetch" href="https://hm.baidu.com/">
  
  
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="https://api.github.com">
  <link rel="dns-prefetch" href="https://avatars3.githubusercontent.com">
  
  <link rel="stylesheet" type="text/css" href="/./style/main.d9e3dd.css">
	<link rel="shortcut icon" href="/favicon.ico" title="Favicon">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
	<title>Hiveä¼˜åŒ–</title>
  
  <script>var _hmt=_hmt||[];(function(){var hm=document.createElement("script");hm.src="https://hm.baidu.com/hm.js?bc39ced90d9f89c71fda7b7d4ca8b638";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();
  </script>
  
  
    <script>(function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/949e21d7.js","daovoice");daovoice('init',{app_id: "949e21d7"});daovoice('update');
  </script>
  
</head>
<body>
<canvas id="pattern-placeholder" height="230"></canvas>
<div class="navbar-header">
  <a class="blog-title" href="/">Sunriseå±±è„‰</a>
  <a class="face-img" href="/">
    <img src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1545985146898&amp;di=2861af758f070858999b0a2a0e708388&amp;imgtype=0&amp;src=http%3A%2F%2Fb-ssl.duitang.com%2Fuploads%2Fitem%2F201610%2F11%2F20161011203442_eHhSV.jpeg">
  </a>
</div>
<main>
  <div class="article-title">
    
  
  <h1 class="title">
    Hiveä¼˜åŒ–
  </h1>
  


    <ul class="article-info">
      <li>
        å‘å¸ƒ
        <time datetime="2019-01-13T16:00:00.000Z" itemprop="datePublished">2019-01-14</time>
      </li>
      <li>
        
    æ›´æ–° <time datetime="2019-01-25T10:52:16.860Z" itemprop="dateUpdated">2019-01-25</time>

      </li>
      <li id="busuanzi_container_page_pv">
        é˜…è¯» <span id="busuanzi_value_page_pv"></span>
      </li>
    </ul>
  </div>
  <div class="container">
    <div class="article">
      <div class="content">
        
        <p>[TOC]</p>
<h1 id="Hiveä¼˜åŒ–"><a href="#Hiveä¼˜åŒ–" class="headerlink" title="Hiveä¼˜åŒ–"></a>Hiveä¼˜åŒ–</h1><h2 id="ä¸€ã€æ ¸å¿ƒæ€æƒ³ï¼š"><a href="#ä¸€ã€æ ¸å¿ƒæ€æƒ³ï¼š" class="headerlink" title="ä¸€ã€æ ¸å¿ƒæ€æƒ³ï¼š"></a>ä¸€ã€æ ¸å¿ƒæ€æƒ³ï¼š</h2><blockquote>
<p>æŠŠHive SQL å½“åšMapReduceç¨‹åºè¿›è¡Œä¼˜åŒ–</p>
</blockquote>
<p><code>æ³¨æ„ï¼š</code>ä»¥ä¸‹ä¸èƒ½HQLè½¬åŒ–ä¸ºMapreduceä»»åŠ¡è¿è¡Œ</p>
<p>â€”select ä»…æŸ¥è¯¢æœ¬è¡¨å­—æ®µ</p>
<p>â€”where ä»…å¯¹æœ¬è¡¨å­—æ®µåšæ¡ä»¶è¿‡æ»¤</p>
<h2 id="äºŒã€explain"><a href="#äºŒã€explain" class="headerlink" title="äºŒã€explain"></a>äºŒã€explain</h2><blockquote>
<p>ç”¨ä»¥æ˜¾ç¤ºä»»åŠ¡æ‰§è¡Œè®¡åˆ’</p>
<p>æ ¼å¼ï¼š</p>
<p>EXPLAIN [EXTENDED|DEPENDENCY|AUTHORIZATION] query</p>
</blockquote>
<p><code>è¯­æ³•è§£é‡Š</code></p>
<blockquote>
<p>ä»è¯­æ³•ç»„æˆå¯ä»¥çœ‹å‡ºæ¥æ˜¯ä¸€ä¸ªâ€œexplain â€+ä¸‰ä¸ªå¯é€‰å‚æ•°+æŸ¥è¯¢è¯­å¥ã€‚å¤§å®¶å¯ä»¥ç§¯æå°è¯•ä¸€ä¸‹ï¼Œåé¢ä¸¤ä¸ªæ˜¾ç¤ºå†…å®¹å¾ˆç®€å•çš„ï¼Œæˆ‘ä»‹ç»ä¸€ä¸‹ç¬¬ä¸€ä¸ª extended è¿™ä¸ªå¯ä»¥æ˜¾ç¤ºhqlè¯­å¥çš„è¯­æ³•æ ‘</p>
<p>å…¶æ¬¡ï¼Œæ‰§è¡Œè®¡åˆ’ä¸€å…±æœ‰ä¸‰ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li>è¿™ä¸ªè¯­å¥çš„æŠ½è±¡è¯­æ³•æ ‘</li>
<li><p>è¿™ä¸ªè®¡åˆ’ä¸åŒé˜¶æ®µä¹‹é—´çš„ä¾èµ–å…³ç³»</p>
</li>
<li><p>å¯¹äºæ¯ä¸ªé˜¶æ®µçš„è¯¦ç»†æè¿°</p>
</li>
</ul>
</blockquote>
<p><code>ä¾‹å­ï¼š</code></p>
<blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; hive&gt; explain select * from log;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><code>æ‹“å±•</code>è¯¾ä¸‹æŸ¥è¯¢MySQlçš„æ‰§è¡Œè®¡åˆ’ã€‚</p>
<h2 id="ä¸‰ã€Hiveè¿è¡Œæ–¹å¼"><a href="#ä¸‰ã€Hiveè¿è¡Œæ–¹å¼" class="headerlink" title="ä¸‰ã€Hiveè¿è¡Œæ–¹å¼"></a>ä¸‰ã€Hiveè¿è¡Œæ–¹å¼</h2><h3 id="é›†ç¾¤æ¨¡å¼ï¼š"><a href="#é›†ç¾¤æ¨¡å¼ï¼š" class="headerlink" title="é›†ç¾¤æ¨¡å¼ï¼š"></a>é›†ç¾¤æ¨¡å¼ï¼š</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ‰§è¡Œhqlï¼š</span><br><span class="line">hive&gt; select count(*) from log;</span><br></pre></td></tr></table></figure>
<p><code>ç»“è®ºï¼š</code></p>
<blockquote>
<p>å‡½æ•°ï¼ˆå¦‚countï¼‰æ˜¯åœ¨reduceé˜¶æ®µè¿›è¡Œ<br>é»˜è®¤æäº¤åˆ°yarnæ‰€åœ¨çš„èŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œ</p>
</blockquote>
<hr>
<h3 id="ä¼˜åŒ–ä¸€"><a href="#ä¼˜åŒ–ä¸€" class="headerlink" title="ä¼˜åŒ–ä¸€:"></a>ä¼˜åŒ–ä¸€:</h3><p>è®¾ç½®  æœ¬åœ°æ¨¡å¼ï¼ˆè¿è¡Œé€Ÿåº¦åŠ å¿«ã€‚ä½†å¯¹åŠ è½½æ–‡ä»¶æœ‰é™åˆ¶ï¼‰</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hive&gt;set hive.exec.mode.local.auto=true;</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹ï¼š</span><br><span class="line">hive&gt;set hive.exec.mode.local.auto</span><br></pre></td></tr></table></figure>
<p><code>ä½†æ˜¯</code>å¦‚æœåŠ è½½æ–‡ä»¶çš„æœ€å¤§å€¼å¤§äºé…ç½®ï¼ˆé»˜è®¤é…ç½®ä¸º100Mï¼‰ï¼Œä»ä¼šä½¿ç”¨é›†ç¾¤æ¨¡å¼è¿è¡Œï¼ˆåœ¨yarnæ‰€åœ¨çš„èŠ‚ç‚¹ï¼‰</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æŸ¥çœ‹æœ€å¤§åŠ è½½æ–‡ä»¶</span><br><span class="line">hive&gt; set hive.exec.mode.local.auto.inputbytes.max;</span><br><span class="line"></span><br><span class="line">æ˜¾ç¤ºï¼š</span><br><span class="line">hive.exec.mode.local.auto.inputbytes.max=134217728</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="ä¼˜åŒ–äºŒï¼š"><a href="#ä¼˜åŒ–äºŒï¼š" class="headerlink" title="ä¼˜åŒ–äºŒï¼š"></a>ä¼˜åŒ–äºŒï¼š</h3><p>è®¾ç½® ä¸¥æ ¼æ¨¡å¼</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">é€šè¿‡è®¾ç½®ä»¥ä¸‹å‚æ•°å¼€å¯ä¸¥æ ¼æ¨¡å¼[é˜²æ­¢è¯¯æ“ä½œ]ï¼š</span><br><span class="line">hive&gt; set hive.mapred.mode=strict;</span><br><span class="line">ï¼ˆé»˜è®¤ä¸ºï¼šnonstrictéä¸¥æ ¼æ¨¡å¼ï¼‰</span><br></pre></td></tr></table></figure>
<p><code>ä½†æ˜¯</code>å­˜åœ¨æŸ¥è¯¢é™åˆ¶</p>
<blockquote>
<p>1ã€å¯¹åˆ†åŒºè¡¨æŸ¥è¯¢æ—¶ï¼Œå¿…é¡»æ·»åŠ whereå¯¹äºåˆ†åŒºå­—æ®µçš„æ¡ä»¶è¿‡æ»¤ï¼›</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; hive&gt; select * from day_table where dt='2019-01-13';</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>2ã€order byè¯­å¥å¿…é¡»åŒ…å«limitè¾“å‡ºé™åˆ¶ï¼›</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; hive&gt; select * from log order by id limit 1;</span><br><span class="line">&gt; è¿™é‡Œçš„1ï¼Œ è¡¨ç¤ºæ˜¾ç¤ºå‰å¤šå°‘æ¡è®°å½•ï¼Œåªèƒ½è®¾ä¸€ä¸ªæ•°å­—</span><br><span class="line">&gt; å’ŒMysqlï¼ˆå¯ä»¥ä»0 å¼€å§‹ï¼‰ä¸åŒçš„æ˜¯ï¼Œå®ƒåªèƒ½ä»1å¼€å§‹</span><br><span class="line">&gt; mysqlå¯ä»¥æœ‰ä¸¤ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºä»ç¬¬å‡ æ¡å¼€å§‹ï¼Œæ˜¾ç¤ºå‡ æ¡</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>3ã€é™åˆ¶æ‰§è¡Œç¬›å¡å°”ç§¯çš„æŸ¥è¯¢</p>
</blockquote>
<p><img src="https://ws1.sinaimg.cn/large/005zftzDgy1fzhry9ni0xj30m10cjdgp.jpg" alt="imit"><span class="img-alt">imit</span></p>
<h2 id="å››ã€Hiveæ’åº"><a href="#å››ã€Hiveæ’åº" class="headerlink" title="å››ã€Hiveæ’åº"></a>å››ã€Hiveæ’åº</h2><h3 id="1ã€Order-By"><a href="#1ã€Order-By" class="headerlink" title="1ã€Order By"></a>1ã€Order By</h3><p>â€” å¯¹äºæŸ¥è¯¢ç»“æœåš<code>å…¨å±€</code>æ’åºï¼Œåªå…è®¸æœ‰<code>ä¸€ä¸ª</code>reduceå¤„ç†<br>ï¼ˆå½“æ•°æ®é‡è¾ƒå¤§æ—¶ï¼Œreduceæ•°é‡æœ‰é™ï¼Œåº”æ…ç”¨ã€‚</p>
<p>â€‹     ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå¿…é¡»ç»“åˆlimitæ¥ä½¿ç”¨ï¼‰</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from log order by idï¼›</span><br></pre></td></tr></table></figure>
<h3 id="2ã€Sort-By"><a href="#2ã€Sort-By" class="headerlink" title="2ã€Sort By"></a>2ã€Sort By</h3><p>â€“ å¯¹äº<code>å•ä¸ª</code>reduceçš„æ•°æ®è¿›è¡Œæ’åº</p>
<p>â€“å±€éƒ¨ï¼ˆå•ä¸ªreduceï¼‰æœ‰åºï¼Œå…¨å±€æ— åº</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å¯ä»¥é€šè¿‡è®¾ç½®mapred.reduce.tasksçš„å€¼æ¥æ§åˆ¶reduceçš„æ•°ï¼Œç„¶åå¯¹reduceè¾“å‡ºçš„ç»“æœåšäºŒæ¬¡æ’åº</span><br></pre></td></tr></table></figure>
<p><code>æ¡ˆä¾‹</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">log</span> <span class="keyword">sort</span> <span class="keyword">by</span> <span class="keyword">id</span>;       (ç»“æœæ— åº)</span><br></pre></td></tr></table></figure>
<p><code>æ˜¾ç¤º</code></p>
<blockquote>
<p>Time taken: 147.077 seconds, Fetched: 7 row(s)</p>
</blockquote>
<h3 id="3ã€Distribute-By"><a href="#3ã€Distribute-By" class="headerlink" title="3ã€Distribute By"></a>3ã€Distribute By</h3><p>â€“ åˆ†åŒºæ’åºï¼Œç»å¸¸å’Œ Sort By ç»“åˆä½¿ç”¨ å…¨å±€æœ‰åºï¼Œå±€éƒ¨æ— åº</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">log</span> <span class="keyword">distribute</span> <span class="keyword">by</span> <span class="keyword">id</span>;     ï¼ˆç»“æœæ— åºï¼‰</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Time taken: 144.708 seconds, Fetched: 7 row(s)</p>
</blockquote>
<p><code>æ³¨æ„ï¼š</code>hiveè¦æ±‚DISTRIBUTE BYè¯­å¥å‡ºç°åœ¨SORT BYè¯­å¥ä¹‹å‰</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Distribute Byå¯ä»¥å°†Mapé˜¶æ®µè¾“å‡ºçš„æ•°æ®æŒ‰æŒ‡å®šçš„å­—æ®µåˆ’åˆ†åˆ°ä¸åŒçš„reduceæ–‡ä»¶ä¸­ï¼Œç„¶åï¼Œsort by å¯¹reduceé˜¶æ®µçš„è¾“å‡ºæ•°æ®åšæ’åºã€‚</span><br></pre></td></tr></table></figure>
<p><code>æ¡ˆä¾‹:</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">log</span> <span class="keyword">distribute</span> <span class="keyword">by</span> <span class="keyword">id</span> <span class="keyword">sort</span> <span class="keyword">by</span> <span class="keyword">id</span> <span class="keyword">asc</span>;   ï¼ˆç»“æœæ— åºï¼‰</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from (select * from log distribute by id) a sort by a.id ;s</span><br></pre></td></tr></table></figure>
<p><code>æ”¹è‰¯</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.* <span class="keyword">from</span> (<span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">log</span> cluster <span class="keyword">by</span> <span class="keyword">id</span> ) a <span class="keyword">order</span> <span class="keyword">by</span> a.id <span class="keyword">limit</span> <span class="number">9</span> ; (ç»“æœæœ‰åº)</span><br><span class="line"></span><br><span class="line">9 åœ¨è¿™é‡Œæ˜¯è¡¨ä¸­æ•°æ®è®°å½•çš„æ€»æ¡æ•°</span><br></pre></td></tr></table></figure>
<p>æ˜¾ç¤ºï¼š</p>
<blockquote>
<p> Time taken: 234.593 seconds, Fetched: 7 row(s)</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">log</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">id</span> <span class="keyword">limit</span> <span class="number">9</span>;    ï¼ˆç»“æœæœ‰åºï¼‰</span><br></pre></td></tr></table></figure>
<p>æ˜¾ç¤ºï¼š</p>
<blockquote>
<p> Time taken: 102.065 seconds, Fetched: 7 row(s)</p>
</blockquote>
<h3 id="4ã€Cluster-By"><a href="#4ã€Cluster-By" class="headerlink" title="4ã€Cluster By"></a>4ã€Cluster By</h3><p>â€“ ç›¸å½“äº Sort By + Distribute By<br>ï¼ˆCluster Byä¸èƒ½é€šè¿‡ascã€descçš„æ–¹å¼æŒ‡å®šæ’åºè§„åˆ™ï¼›<br>å¯é€šè¿‡ distribute by column sort by column asc|desc çš„æ–¹å¼ï¼‰</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">log</span> cluster <span class="keyword">by</span> <span class="keyword">id</span>ï¼›    ï¼ˆç»“æœæ— åºï¼‰</span><br></pre></td></tr></table></figure>
<h2 id="äº”ã€Hive-Join-ï¼ˆé‡éš¾ç‚¹ï¼‰"><a href="#äº”ã€Hive-Join-ï¼ˆé‡éš¾ç‚¹ï¼‰" class="headerlink" title="äº”ã€Hive Join  ï¼ˆé‡éš¾ç‚¹ï¼‰"></a>äº”ã€Hive Join  ï¼ˆé‡éš¾ç‚¹ï¼‰</h2><h3 id="1ã€Join-è¿æ¥æ—¶ï¼Œå°†å°è¡¨ï¼ˆé©±åŠ¨è¡¨ï¼‰æ”¾åœ¨joinçš„å·¦è¾¹"><a href="#1ã€Join-è¿æ¥æ—¶ï¼Œå°†å°è¡¨ï¼ˆé©±åŠ¨è¡¨ï¼‰æ”¾åœ¨joinçš„å·¦è¾¹" class="headerlink" title="1ã€Join è¿æ¥æ—¶ï¼Œå°†å°è¡¨ï¼ˆé©±åŠ¨è¡¨ï¼‰æ”¾åœ¨joinçš„å·¦è¾¹"></a>1ã€Join è¿æ¥æ—¶ï¼Œå°†å°è¡¨ï¼ˆé©±åŠ¨è¡¨ï¼‰æ”¾åœ¨joinçš„å·¦è¾¹</h3><h3 id="2ã€Map-Join-ï¼š"><a href="#2ã€Map-Join-ï¼š" class="headerlink" title="2ã€Map Join ï¼š"></a>2ã€Map Join ï¼š</h3><blockquote>
<p>å› ä¸ºMap Join æ˜¯åœ¨Mapç«¯ä¸”åœ¨å†…å­˜ä¸­è¿›è¡Œçš„ï¼Œæ‰€ä»¥ä¸éœ€è¦å¯åŠ¨Reduceä»»åŠ¡ï¼Œä¹Ÿæ²¡æœ‰shuffleé˜¶æ®µï¼Œä»è€Œåœ¨ä¸€å®šç¨‹åº¦ä¸ŠèŠ‚çœèµ„æºï¼Œæé«˜Joinæ•ˆç‡ã€‚</p>
</blockquote>
<h3 id="æ–¹å¼ï¼šï¼ˆä¸¤ç§ï¼‰"><a href="#æ–¹å¼ï¼šï¼ˆä¸¤ç§ï¼‰" class="headerlink" title="æ–¹å¼ï¼šï¼ˆä¸¤ç§ï¼‰"></a>æ–¹å¼ï¼šï¼ˆä¸¤ç§ï¼‰</h3><h4 id="1ã€SQLæ–¹å¼ï¼š"><a href="#1ã€SQLæ–¹å¼ï¼š" class="headerlink" title="1ã€SQLæ–¹å¼ï¼š"></a>1ã€SQLæ–¹å¼ï¼š</h4><p>â€‹     åœ¨HQlè¯­å¥ä¸­æ·»åŠ MapJoinæ ‡è®°ï¼ˆmapjoinï¼‰(å°†å°è¡¨åŠ å…¥åˆ°å†…å­˜ï¼Œæ³¨æ„å°è¡¨çš„å¤§å°)</p>
<p>â€‹     è¯­æ³•ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="comment">/*+ MAPJOIN(smallTable) */</span>  smallTable.key,  bigTable.value </span><br><span class="line"><span class="keyword">FROM</span>  smallTable  <span class="keyword">JOIN</span>  bigTable  <span class="keyword">ON</span>  smallTable.key  = bigTable.key;</span><br></pre></td></tr></table></figure>
<p><code>æ¡ˆä¾‹ï¼š</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="comment">/*+ MAPJOIN(log1) */</span>  log.id,log1.name </span><br><span class="line"><span class="keyword">FROM</span>  <span class="keyword">log</span>  <span class="keyword">JOIN</span>  log1  <span class="keyword">ON</span>  log.id  = log1.id;</span><br></pre></td></tr></table></figure>
<h4 id="2ã€è‡ªåŠ¨çš„MapJoin"><a href="#2ã€è‡ªåŠ¨çš„MapJoin" class="headerlink" title="2ã€è‡ªåŠ¨çš„MapJoin"></a>2ã€è‡ªåŠ¨çš„MapJoin</h4><p>â€‹           é€šè¿‡ä¿®æ”¹ä»¥ä¸‹é…ç½®å¯ç”¨è‡ªåŠ¨çš„mapjoinï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive&gt; set hive.auto.convert.join = true;</span><br></pre></td></tr></table></figure>
<p>â€‹    ï¼ˆ  è¯¥å‚æ•°ä¸ºtrueæ—¶ï¼ŒHiveè‡ªåŠ¨å¯¹å·¦è¾¹çš„è¡¨ç»Ÿè®¡æ•°æ®é‡ï¼Œå¦‚æœæ˜¯å°è¡¨å°±åŠ å…¥å†…å­˜ï¼Œå³å¯¹å°è¡¨ä½¿ç”¨Map joinï¼‰<br>å…¶ä»–ç›¸å…³é…ç½®å‚æ•°ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive&gt; set hive.mapjoin.smalltable.filesize;</span><br></pre></td></tr></table></figure>
<p>ï¼ˆé»˜è®¤ï¼šå¤§è¡¨å°è¡¨åˆ¤æ–­çš„é˜ˆå€¼25MBå·¦å³ï¼Œå¦‚æœè¡¨çš„å¤§å°å°äºè¯¥å€¼åˆ™ä¼šè¢«åŠ è½½åˆ°å†…å­˜ä¸­è¿è¡Œï¼Œå¯è‡ªå®šä¹‰ï¼‰</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive&gt; set hive.ignore.mapjoin.hint;</span><br></pre></td></tr></table></figure>
<p>ï¼ˆé»˜è®¤å€¼ï¼štrueï¼›æ˜¯å¦å¿½ç•¥mapjoin hint å³mapjoinæ ‡è®°ï¼›å¦‚æœä¸ºfalseï¼Œè¿™åˆ™éœ€è¦æ·»åŠ -MapJoinæ ‡è®°ï¼Œmapjoinï¼ˆsmalltableï¼‰ï¼‰</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive&gt; set hive.auto.convert.join.noconditionaltask;</span><br></pre></td></tr></table></figure>
<p>ï¼ˆé»˜è®¤å€¼ï¼štrueï¼›å°†æ™®é€šçš„joinè½¬åŒ–ä¸ºæ™®é€šçš„mapjoinæ—¶ï¼Œæ˜¯å¦å°†å¤šä¸ªmapjoinè½¬åŒ–ä¸ºä¸€ä¸ªmapjoinï¼‰</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive&gt; set hive.auto.convert.join.noconditionaltask.size;</span><br></pre></td></tr></table></figure>
<p>ï¼ˆé»˜è®¤ï¼š10Mï¼›å°†å¤šä¸ªmapjoinè½¬åŒ–ä¸ºä¸€ä¸ªmapjoinæ—¶ï¼Œå…¶è¡¨çš„æœ€å¤§å€¼ä¸º10Mï¼Œå¯è‡ªå®šä¹‰ï¼‰</p>
<h2 id="å…­ã€Map-Sideèšåˆ"><a href="#å…­ã€Map-Sideèšåˆ" class="headerlink" title="å…­ã€Map-Sideèšåˆ"></a>å…­ã€Map-Sideèšåˆ</h2><blockquote>
<p>ç›¸å½“äºèšåˆå‡½æ•°ï¼šcountï¼ˆï¼‰</p>
</blockquote>
<p>è®¾ç½®å‚æ•°ï¼Œå¼€å¯åœ¨Mapç«¯çš„èšåˆ</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> hive.map.aggr=<span class="literal">true</span>;</span><br></pre></td></tr></table></figure>
<p>ç›¸å…³é…ç½®å‚æ•°ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> hive.groupby.mapaggr.checkintervalï¼›</span><br></pre></td></tr></table></figure>
<p>ï¼ˆé»˜è®¤ä¸ºï¼š100000ï¼Œè¡¨ç¤º mapç«¯group byæ‰§è¡Œèšåˆæ—¶å¤„ç†çš„å¤šå°‘è¡Œæ•°æ®ï¼‰</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> hive.map.aggr.hash.min.reductionï¼›</span><br></pre></td></tr></table></figure>
<p>ï¼ˆé»˜è®¤ä¸ºï¼š0.5ï¼Œè¿›è¡Œèšåˆçš„æœ€å°æ¯”ä¾‹ï¼Œé¢„å…ˆå–100000æ¡æ•°æ®èšåˆ,å¦‚æœèšåˆåçš„æ¡æ•°/100000&gt;0.5ï¼Œåˆ™ä¸å†èšåˆï¼‰</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> hive.map.aggr.hash.percentmemory;</span><br></pre></td></tr></table></figure>
<p>ï¼ˆé»˜è®¤ï¼š 0.5 ï¼Œmapç«¯èšåˆä½¿ç”¨çš„å†…å­˜çš„æœ€å¤§å€¼ï¼‰</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> hive.map.aggr.hash.force.flush.memory.threshold;</span><br></pre></td></tr></table></figure>
<p>ï¼ˆé»˜è®¤ä¸ºï¼š0.9ï¼Œmapç«¯åšèšåˆæ“ä½œæ˜¯hashè¡¨çš„æœ€å¤§å¯ç”¨å†…å®¹ï¼Œå¤§äºè¯¥å€¼åˆ™ä¼šè§¦å‘flush</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> hive.groupby.skewindataï¼›</span><br></pre></td></tr></table></figure>
<p>ï¼ˆé»˜è®¤ä¸ºï¼šfalseï¼Œæ˜¯å¦å¯¹GroupByäº§ç”Ÿçš„æ•°æ®å€¾æ–œåšä¼˜åŒ–ï¼‰</p>
<p><code>é™„åŠ ï¼š</code></p>
<blockquote>
<ul>
<li>æ•°æ®å€¾æ–œé—®é¢˜è§£å†³ï¼šå¤šç§æ–¹å¼ï¼ˆä½¿ç”¨MapJoinã€ä½¿ç”¨MapSideï¼‰</li>
</ul>
</blockquote>
<p><code>å‚è€ƒ</code></p>
<p><a href="http://www.sohu.com/a/224276626_543508" target="_blank" rel="noopener">http://www.sohu.com/a/224276626_543508</a></p>
<h2 id="ä¸ƒã€æ§åˆ¶Hiveä¸­Mapå’ŒReduceçš„æ•°é‡"><a href="#ä¸ƒã€æ§åˆ¶Hiveä¸­Mapå’ŒReduceçš„æ•°é‡" class="headerlink" title="ä¸ƒã€æ§åˆ¶Hiveä¸­Mapå’ŒReduceçš„æ•°é‡"></a>ä¸ƒã€æ§åˆ¶Hiveä¸­Mapå’ŒReduceçš„æ•°é‡</h2><h3 id="1ã€Mapæ•°é‡ç›¸å…³çš„å‚æ•°"><a href="#1ã€Mapæ•°é‡ç›¸å…³çš„å‚æ•°" class="headerlink" title="1ã€Mapæ•°é‡ç›¸å…³çš„å‚æ•°"></a>1ã€Mapæ•°é‡ç›¸å…³çš„å‚æ•°</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> mapred.max.split.size;</span><br></pre></td></tr></table></figure>
<p>ï¼ˆé»˜è®¤ä¸ºï¼š256Mï¼Œä¸€ä¸ªsplitçš„æœ€å¤§å€¼ï¼Œå³æ¯ä¸ªmapå¤„ç†æ–‡ä»¶çš„æœ€å¤§å€¼ï¼‰</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> mapred.min.split.size.per.node;</span><br></pre></td></tr></table></figure>
<p>(ä¸€ä¸ªèŠ‚ç‚¹ä¸Šæœ€å°splitæ•°ï¼š1ä¸ª)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> mapred.min.split.size.per.rack;</span><br></pre></td></tr></table></figure>
<p>(ä¸€ä¸ªæœºæ¶ä¸Šæœ€å°splitæ•°ï¼š1ä¸ª)</p>
<h3 id="2ã€Reduceæ•°é‡ç›¸å…³çš„å‚æ•°"><a href="#2ã€Reduceæ•°é‡ç›¸å…³çš„å‚æ•°" class="headerlink" title="2ã€Reduceæ•°é‡ç›¸å…³çš„å‚æ•°"></a>2ã€Reduceæ•°é‡ç›¸å…³çš„å‚æ•°</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> mapred.reduce.tasks;</span><br></pre></td></tr></table></figure>
<p>(é»˜è®¤ä¸ºï¼š-1ï¼Œå¼ºåˆ¶æŒ‡å®šreduceä»»åŠ¡çš„æ•°é‡ã€‚-1ï¼Œæ˜¯æœªå®šä¹‰ï¼Œä¸å‘æŒ¥ä½œç”¨ã€‚å¦‚æœæŒ‡å®šäº†ï¼Œå°±ä¼šæŒ‰æŒ‡å®šçš„æ•°é‡æ‰§è¡Œ)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> hive.exec.reducers.bytes.per.reducer;</span><br></pre></td></tr></table></figure>
<p>ï¼ˆé»˜è®¤ä¸ºï¼š256M ï¼Œæ¯ä¸ªreduceä»»åŠ¡å¤„ç†çš„æ•°æ®é‡ï¼‰</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> hive.exec.reducers.max;</span><br></pre></td></tr></table></figure>
<p>ï¼ˆé»˜è®¤ä¸ºï¼š1009ä¸ªï¼Œæ¯ä¸ªä»»åŠ¡æœ€å¤§çš„reduceæ•° [Mapæ•°é‡ &gt;= Reduceæ•°é‡ ]ï¼‰</p>
<h2 id="å…«ã€Hive-JVMé‡ç”¨"><a href="#å…«ã€Hive-JVMé‡ç”¨" class="headerlink" title="å…«ã€Hive - JVMé‡ç”¨"></a>å…«ã€Hive - JVMé‡ç”¨</h2><p><code>é€‚ç”¨åœºæ™¯ï¼š</code><br>1ã€å°æ–‡ä»¶ä¸ªæ•°è¿‡å¤š<br>2ã€taskä¸ªæ•°è¿‡å¤š</p>
<p><code>åŸç†ï¼š</code></p>
<p>hadoopé»˜è®¤é…ç½®æ˜¯ä½¿ç”¨æ´¾ç”ŸJVMæ¥æ‰§è¡Œmapå’Œreduceä»»åŠ¡çš„ï¼ŒJVMé‡ç”¨å¯ä»¥ä½¿å¾—JVMå®ä¾‹åœ¨åŒä¸€ä¸ªJOBä¸­é‡æ–°ä½¿ç”¨Næ¬¡</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> mapred.job.reuse.jvm.num.tasks;</span><br></pre></td></tr></table></figure>
<p>(é»˜è®¤æ˜¯1ï¼Œè¡¨ç¤ºä¸€ä¸ªJVMä¸Šæœ€å¤šå¯ä»¥é¡ºåºæ‰§è¡Œçš„taskæ•°ç›®ï¼ˆå±äºåŒä¸€ä¸ªJobï¼‰æ˜¯1ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªtaskå¯ä¸€ä¸ªJVM)</p>
<p><code>ç¼ºç‚¹ï¼š</code></p>
<p>è®¾ç½®å¼€å¯ä¹‹åï¼Œtaskæ’æ§½ä¼šä¸€ç›´å ç”¨èµ„æºï¼Œä¸è®ºæ˜¯å¦æœ‰taskè¿è¡Œï¼Œ<br>ç›´åˆ°æ‰€æœ‰çš„taskå³æ•´ä¸ªjobå…¨éƒ¨æ‰§è¡Œå®Œæˆæ—¶ï¼Œæ‰ä¼šé‡Šæ”¾æ‰€æœ‰çš„taskæ’æ§½èµ„æºï¼</p>

      </div>
        <div class="support-author">
          <p>æ„Ÿè°¢æ‚¨çš„é˜…è¯»ã€‚ ğŸ™
          <a href="https://888.com/index.html" target="_blank">å…³äºè½¬è½½è¯·çœ‹è¿™é‡Œ</a>
            <!--<a class="btn-pay"  href="#pay-modal">Â¥ æ‰“èµæ”¯æŒ</a>-->
          </p>
        </div>
        <!--
            <div class="like ">
              <div class="like-button">
                <a id="like-note" href="">
                  <i class="icon-heart"></i>å–œæ¬¢
                </a>
              </div>
              <span id="likes-count">256</span>
            </div>
        -->
        <div class="otherLink">
          <div class="previous">
          </div>
          <div class="next">
          </div>
        </div>
        <div class="comments" id="comments">
          
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script type="text/javascript">
  const gitalk = new Gitalk({
    clientID: '6b3c35f853de938a9612',
    clientSecret: '70003661fc70b011a32d9d1b2197666021305201',
    repo: 'sungithup.github.io',
    owner: 'admin',
    admin: ['admin'],
    id: location.pathname,      // Ensure uniqueness and length less than 50
    distractionFreeMode: false
  })

  gitalk.render('comments');
</script>


        </div>
      </div>
    </div>
   
</main>
<div class="footer">
  <div class="info">
    <p>
    <a href="https://hexo.io"> Hexo </a> å¼ºåŠ›é©±åŠ¨ |
      <a href="https://github.com/Youthink/hexo-themes-yearn"> Yearn </a>
      ä¸»é¢˜
    </p>
    <p>&copy;2013-2019 Sukieçš„ä¸ªäººåšå®¢ äº¬ICPå¤‡xxxxxxå·</p>
  </div>
</div>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script>//console
  var consoleConfig = '\næ¬¢è¿è®¿é—® https://hufangyun.com ï¼Œå›´è§‚å°çŒ¿å¤§åœ£çš„åšå®¢(ã¥ï½¡â—•â€¿â€¿â—•ï½¡)ã¥ï¼\n,\næœ¬åšå®¢ä½¿ç”¨ %cHexo%c æ­å»ºï¼Œåšå®¢ä¸»é¢˜ä¸ºå°çŒ¿å¤§åœ£å¼€å‘çš„ %chexo-themes-yearn%c ~~~ ğŸ‰ğŸ‰ğŸ‰ \n\næºç  https://github.com/Youthink/hexo-themes-yearn \n\nå¦‚æœå–œæ¬¢å¯ä»¥ star æ”¯æŒä¸€ä¸‹ â¤ï¸~\n,\næ‰«æä¸‹é¢çš„äºŒç»´ç ï¼Œåœ¨æ‰‹æœºä¸ŠæŸ¥çœ‹åšå®¢ï¼\n,https://static.hufangyun.com/blog-url-qrcode-180-180.png,\n æƒ³çŸ¥é“è¿™ä¸ªæ•ˆæœå¦‚ä½•å®ç°çš„ï¼Ÿåšå®¢å†…æœç´¢ console å½©è›‹ ğŸš€ ï¼\n'.split(',');
  var canConsole = true;
  var consoleInfo = (function(consoleConfig) {
  if (!canConsole || !consoleConfig || consoleConfig.length < 1) {
    return;
  }
  var consoleColor = '#6190e8';
  var _console;
  var backgroundTextStyle = 'padding: 1px 5px;color: #fff;background: ' + consoleColor + ';'
  var textStyle = 'color: ' + consoleColor + ';';

  consoleConfig.map(o => {
    var num = (o.match(/%c/g) || []).length;
    if(/^http(s)?:\/\//.test(o)) {
      console.log('%c     ', 'background: url(' + o + ') no-repeat left center;font-size: 180px;');
      return;
    }
    if (num > 0) {
      var logArguments = [];
      for (var i = 0; i < num; i++) {
        if (i % 2 === 0) {
          logArguments.push(backgroundTextStyle);
        } else {
          logArguments.push(textStyle);
        }
      }
      (_console = console).log.apply(_console, ['%c' + o, textStyle].concat(logArguments));
      return;
    }
    console.log('%c' + o, textStyle);
  });
}(consoleConfig));</script><script type="text/javascript" src="/./js/main.d9e3dd.js"></script>

</body>
</html>
